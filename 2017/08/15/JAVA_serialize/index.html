<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="不知道描述啥"><title>JAVA序列化 | Sing</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">JAVA序列化</h1><a id="logo" href="/.">Sing</a><p class="description">笔记</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined"> 首页</i></a><a href="/django"><i class="fa undefined"> Django</i></a><a href="/html_css"><i class="fa undefined"> Html_css</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySql/">MySql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/11/MySql_Linux_install_mysql/">Linux 环境下安装MySql</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/29/Python_crawler/">用 Python 编写一个简单的爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/19/Android_CountDownTimer/">CountDownTimer的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/05/Android_decompile/">Android 反编译</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/01/Android_dialog_shadow/">Android 使用Dialog时状态栏变黑的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/21/Python_Django_simple_server/">基于 Python 的简单服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/21/Android_about_image/">Android 图片相关操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/16/DesignPattern_01_Principle/">《设计模式》走向灵活软件之路--面向对象的六大原则</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/13/MySql-17_indexes/">MySql_17 MySQL中的索引</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/10/Android_Application_Analysis/">Application 全面解析</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">JAVA序列化</h1><div class="post-meta">Aug 15, 2017<span> | </span><span class="category"><a href="/categories/JAVA/">JAVA</a></span></div><div class="post-content"><h4 id="1、什么是序列化和反序列化"><a href="#1、什么是序列化和反序列化" class="headerlink" title="1、什么是序列化和反序列化"></a>1、什么是序列化和反序列化</h4><ul>
<li>Serialization（序列化）是一种将对象以一连串的字节描述的过程。</li>
<li>反序列化deserialization是一种将这些字节重建成一个对象的过程。  </li>
</ul>
<h4 id="2、什么情况下需要序列化"><a href="#2、什么情况下需要序列化" class="headerlink" title="2、什么情况下需要序列化"></a>2、什么情况下需要序列化</h4><ul>
<li>当你想把的内存中的对象保存到一个文件中或者数据库中时候(数据持久化)；</li>
<li>利用序列化实现远程通信，即在网络上传送对象的字节序列；</li>
</ul>
<h4 id="3、如何实现序列化"><a href="#3、如何实现序列化" class="headerlink" title="3、如何实现序列化"></a>3、如何实现序列化</h4><ul>
<li>将需要序列化的类实现Serializable接口就可以了，Serializable接口中没有任何方法，可以理解为一个标记，即表明这个类可以序列化.</li>
</ul>
<h4 id="4、序列化和反序列化例子"><a href="#4、序列化和反序列化例子" class="headerlink" title="4、序列化和反序列化例子"></a>4、序列化和反序列化例子</h4><ul>
<li>如果我们想要序列化一个对象，首先要创建某些OutputStream(如FileOutputStream、ByteArrayOutputStream等)，然后将这些OutputStream封装在一个ObjectOutputStream中。这时候，只需要调用writeObject()方法就可以将对象序列化，并将其发送给OutputStream（对象的序列化是基于字节的，不能使用Reader和Writer等基于字符的层次结构）。而反序列的过程（即将一个序列还原成为一个对象），需要将一个InputStream(如FileInputstream、ByteArrayInputStream等)封装在ObjectInputStream内，然后调用readObject()即可。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.serialize;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;  </span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Serialize</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5211389707739541364L</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> num = <span class="number">1390</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialized</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">"serialize.obj"</span>);  </span><br><span class="line">            ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(fos);  </span><br><span class="line">            Serialize serialize = <span class="keyword">new</span> Serialize();  </span><br><span class="line">            oos.writeObject(serialize);  </span><br><span class="line">            oos.flush();  </span><br><span class="line">            oos.close();<span class="comment">//只是为了做个例子，真实编程要放到finally下  </span></span><br><span class="line">            fos.close();  </span><br><span class="line">            System.out.println(<span class="string">"序列化结束"</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deserialized</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        Serialize serialize = <span class="keyword">null</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">"serialize.obj"</span>);  </span><br><span class="line">            ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);  </span><br><span class="line">  </span><br><span class="line">            serialize = (Serialize) ois.readObject();  </span><br><span class="line">            ois.close();  </span><br><span class="line">            fis.close();  </span><br><span class="line">            System.out.println(<span class="string">"反序列化结束"</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        System.out.println(serialize.num);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        Serialize serialize = <span class="keyword">new</span> Serialize();  </span><br><span class="line">        serialize.serialized();  </span><br><span class="line">        serialize.deserialized();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">序列化结束  </span><br><span class="line">反序列化结束  </span><br><span class="line"><span class="number">1390</span></span><br></pre></td></tr></table></figure>
<h4 id="5、序列化的数据含有那些信息"><a href="#5、序列化的数据含有那些信息" class="headerlink" title="5、序列化的数据含有那些信息"></a>5、序列化的数据含有那些信息</h4><p>这里举个例子将上面例子中的serialize.obj的信息读取出来：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.serialize;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.File;  </span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadSerialize</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            File file = <span class="keyword">new</span> File(<span class="string">"serialize.obj"</span>);  </span><br><span class="line">            InputStream in = <span class="keyword">new</span> FileInputStream(file);  </span><br><span class="line">            <span class="keyword">byte</span> buff[] = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];  </span><br><span class="line">            <span class="keyword">int</span> len = <span class="number">0</span>;  </span><br><span class="line">            <span class="keyword">while</span>((len = in.read(buff)) !=-<span class="number">1</span>) &#123;  </span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;  </span><br><span class="line">                    System.out.printf(<span class="string">"%02X "</span>,buff[i]);  </span><br><span class="line">                &#125;  </span><br><span class="line">                System.out.println();  </span><br><span class="line">            &#125;  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AC ED <span class="number">00</span> <span class="number">05</span> <span class="number">73</span>     </span><br><span class="line"><span class="number">72</span> <span class="number">00</span> <span class="number">17</span> <span class="number">63</span> <span class="number">6F</span> <span class="number">6</span>D <span class="number">2</span>E <span class="number">73</span> <span class="number">65</span> <span class="number">72</span> <span class="number">69</span> <span class="number">61</span> <span class="number">6</span>C <span class="number">69</span> <span class="number">7</span>A <span class="number">65</span> <span class="number">2</span>E <span class="number">53</span> <span class="number">65</span> <span class="number">72</span> <span class="number">69</span> <span class="number">61</span> <span class="number">6</span>C <span class="number">69</span> <span class="number">7</span>A <span class="number">65</span> B7 AD <span class="number">6</span>C AC <span class="number">04</span> <span class="number">0</span>E D0 <span class="number">8</span>C <span class="number">02</span> <span class="number">00</span> <span class="number">01</span>   </span><br><span class="line"><span class="number">49</span> <span class="number">00</span> <span class="number">03</span> <span class="number">6</span>E <span class="number">75</span> <span class="number">6</span>D   </span><br><span class="line"><span class="number">78</span> <span class="number">70</span>  </span><br><span class="line"><span class="number">00</span> <span class="number">00</span> <span class="number">05</span> <span class="number">6</span>E</span><br></pre></td></tr></table></figure>
<h5 id="第一部分是序列化文件头"><a href="#第一部分是序列化文件头" class="headerlink" title="第一部分是序列化文件头"></a>第一部分是序列化文件头</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AC ED：STREAM_MAGIC声明使用了序列化协议  </span><br><span class="line">00 05：STREAM_VERSION序列化协议版本  </span><br><span class="line">73：TC_OBJECT声明这是一个新的对象</span><br></pre></td></tr></table></figure>
<h5 id="第二部分是序列化类的描述"><a href="#第二部分是序列化类的描述" class="headerlink" title="第二部分是序列化类的描述"></a>第二部分是序列化类的描述</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">72：TC_CLASSDESC声明这里开始一个新class  </span><br><span class="line">00 17：class名字的长度是23字节  </span><br><span class="line">63 6F 6D 2E 73 65 72 69 61 6C 69 7A 65 2E 53 65 72 69 61 6C 69 7A 65:完整类名 </span><br><span class="line">B7 AD 6C AC 04 0E D0 8C： SerialVersionUID  </span><br><span class="line">02：标记号，改值声明改对象支持序列化  </span><br><span class="line">00 01：该类所包含的域的个数为1</span><br></pre></td></tr></table></figure>
<h5 id="第三部分是对象中各个属性项的描述"><a href="#第三部分是对象中各个属性项的描述" class="headerlink" title="第三部分是对象中各个属性项的描述"></a>第三部分是对象中各个属性项的描述</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">49：域类型，代表I,表示Int类型（又如：44，查ASCII码表为D，代表Double类型）  </span><br><span class="line">00 03：域名字的长度，为3  </span><br><span class="line">6E 75 6D: num属性的名称</span><br></pre></td></tr></table></figure>
<h5 id="第四部分输出该对象父类信息描述，这里没有父类，如果有，则数据格式与第二部分一样"><a href="#第四部分输出该对象父类信息描述，这里没有父类，如果有，则数据格式与第二部分一样" class="headerlink" title="第四部分输出该对象父类信息描述，这里没有父类，如果有，则数据格式与第二部分一样"></a>第四部分输出该对象父类信息描述，这里没有父类，如果有，则数据格式与第二部分一样</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">78：TC_ENDBLOCKDATA，对象块接收标志  </span><br><span class="line">70：TC_NULL，说明没有其他超类的标志</span><br></pre></td></tr></table></figure>
<h5 id="第五部分输出对象的属性的实际值，如果属性项是一个对象，那么这里还将序列化这个对象，规则和第2部分一样。"><a href="#第五部分输出对象的属性的实际值，如果属性项是一个对象，那么这里还将序列化这个对象，规则和第2部分一样。" class="headerlink" title="第五部分输出对象的属性的实际值，如果属性项是一个对象，那么这里还将序列化这个对象，规则和第2部分一样。"></a>第五部分输出对象的属性的实际值，如果属性项是一个对象，那么这里还将序列化这个对象，规则和第2部分一样。</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">00 00 05 6E：1390的值</span><br></pre></td></tr></table></figure>
<h4 id="6、序列化前和序列化后的对象的关系"><a href="#6、序列化前和序列化后的对象的关系" class="headerlink" title="6、序列化前和序列化后的对象的关系"></a>6、序列化前和序列化后的对象的关系</h4><p>序列化时深复制，反序列化还原后的对象地址与原来的不同。 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.serialize;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;  </span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.IOException;  </span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;  </span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Serialize</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5211389707739541364L</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> num = <span class="number">1390</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkIsSame</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        Serialize serialize1 = <span class="keyword">new</span> Serialize();  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">"serialize.obj"</span>);  </span><br><span class="line">            ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(fos);  </span><br><span class="line">            oos.writeObject(serialize1);  </span><br><span class="line">            oos.flush();  </span><br><span class="line">            oos.close();<span class="comment">//只是为了做个例子，真实编程要放到finally下  </span></span><br><span class="line">            fos.close();  </span><br><span class="line">            System.out.println(<span class="string">"序列化结束"</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        Serialize serialize2 = <span class="keyword">null</span>;  </span><br><span class="line">        <span class="keyword">try</span> &#123;  </span><br><span class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">"serialize.obj"</span>);  </span><br><span class="line">            ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);  </span><br><span class="line">  </span><br><span class="line">            serialize2 = (Serialize) ois.readObject();  </span><br><span class="line">            ois.close();  </span><br><span class="line">            fis.close();  </span><br><span class="line">            System.out.println(<span class="string">"反序列化结束"</span>);  </span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | IOException e)&#123;  </span><br><span class="line">            e.printStackTrace();  </span><br><span class="line">        &#125;  </span><br><span class="line">        System.out.println(<span class="string">"序列化和反序列化的对象相同否?"</span>+(serialize1==serialize2));  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">        Serialize serialize = <span class="keyword">new</span> Serialize();  </span><br><span class="line">        serialize.checkIsSame();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">序列化结束  </span><br><span class="line">反序列化结束  </span><br><span class="line">序列化和反序列化的对象相同否?<span class="keyword">false</span></span><br></pre></td></tr></table></figure>
<p>序列化前后对象的地址不同了，但是内容是一样的，而且对象中包含的引用也相同。换句话说，通过序列化操作,我们可以实现对任何可Serializable对象的”深度复制（deep copy）”——这意味着我们复制的是整个对象网，而不仅仅是基本对象及其引用。对于同一流的对象，他们的地址是相同，说明他们是同一个对象，但是与其他流的对象地址却不相同。也就说，只要将对象序列化到单一流中，就可以恢复出与我们写出时一样的对象网，而且只要在同一流中，对象都是同一个。</p>
<h4 id="7、破坏单例模式"><a href="#7、破坏单例模式" class="headerlink" title="7、破坏单例模式"></a>7、破坏单例模式</h4><p>序列化和反序列化可能会破坏单例。上面的例子就是个很好的证明，为了更形象，在举一个单例模式的序列化的例子</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.serialize;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerSingleton</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;  </span><br><span class="line">  </span><br><span class="line">    String name;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SerSingleton</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"Singleton is create"</span>);  </span><br><span class="line">        name=<span class="string">"SerSingleton"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SerSingleton instance = <span class="keyword">new</span> SerSingleton();  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SerSingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createString</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"createString in Singleton"</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Test</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;  </span><br><span class="line">        SerSingleton s1= <span class="keyword">null</span>;  </span><br><span class="line">        SerSingleton s = SerSingleton.getInstance();  </span><br><span class="line">  </span><br><span class="line">        FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="string">"SerSingleton.obj"</span>);  </span><br><span class="line">        ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(fos);  </span><br><span class="line">        oos.writeObject(s);  </span><br><span class="line">        oos.flush();  </span><br><span class="line">        oos.close();  </span><br><span class="line">  </span><br><span class="line">        FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="string">"SerSingleton.obj"</span>);  </span><br><span class="line">        ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);  </span><br><span class="line">        s1 = (SerSingleton)ois.readObject();  </span><br><span class="line">       System.out.println(s==s1);  </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Singleton is create  </span><br><span class="line"><span class="keyword">false</span></span><br></pre></td></tr></table></figure>
<p>说明测试代码中的s和s1指向了不同的实例，在反序列化后，生成多个对象实例。稍微修改一下SerSingleton类，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.serialize;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerSingleton</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;  </span><br><span class="line">  </span><br><span class="line">    String name;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SerSingleton</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"Singleton is create"</span>);  </span><br><span class="line">        name=<span class="string">"SerSingleton"</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SerSingleton instance = <span class="keyword">new</span> SerSingleton();  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SerSingleton <span class="title">getInstance</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createString</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">"createString in Singleton"</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">readResolve</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> instance;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行测试代码，结果如下 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Singleton is create  </span><br><span class="line"><span class="keyword">true</span></span><br></pre></td></tr></table></figure>
<p>至于为什么，ObjectIputStream.class的源码中有这样一段话<br><img src="http://oupjofqw3.bkt.clouddn.com/JAVA序列化_0001.png" alt=""><br>一般来说，对单例进行序列化和反序列化的场景并不多见，但如果存在，就要多加注意。</p>
<h4 id="8、序列化ID"><a href="#8、序列化ID" class="headerlink" title="8、序列化ID"></a>8、序列化ID</h4><p>序列化 ID 在 Eclipse 下提供了两种生成策略，一个是固定的 1L，一个是随机生成一个不重复的 long 类型数据（实际上是使用 JDK 工具生成），在这里有一个建议，如果没有特殊需求，就是用默认的 1L 就可以，这样可以确保代码一致时反序列化成功。这也可能是造成序列化和反序列化失败的原因，因为不同的序列化id之间不能进行序列化和反序列化。</p>
<h4 id="9、静态变量能否序列化"><a href="#9、静态变量能否序列化" class="headerlink" title="9、静态变量能否序列化"></a>9、静态变量能否序列化</h4><p>序列化会忽略静态变量，即序列化不保存静态变量的状态。静态成员属于类级别的，所以不能序列化。即 序列化的是对象的状态不是类的状态。这里的不能序列化的意思，是序列化信息中不包含这个静态成员域。transient后的变量也不能序列化。</p>
<p>transient使用小结</p>
<ul>
<li>一旦变量被transient修饰，变量将不再是对象持久化的一部分，该变量内容在序列化后无法获得访问。</li>
<li>transient关键字只能修饰变量，而不能修饰方法和类。注意，本地变量是不能被transient关键字修饰的。变量如果是用户自定义类变量，则该类需要实现Serializable接口。</li>
<li>被transient关键字修饰的变量不再能被序列化，一个静态变量不管是否被transient修饰，均不能被序列化。</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>当父类继承Serializable接口时，所有子类都可以被序列化。</li>
<li>子类实现了Serializable接口，父类没有，父类中的属性不能被序列化（不报错，数据不会丢失），但是在子类中的属性仍能正确序列化</li>
<li>如果序列化的属性是对象，则这个对象也必须实现Serializable接口，否则会报错。</li>
<li>在反序列化时，如果对象的属性有修改或删减，则修改的部分属性会丢失，但不会报错。</li>
<li>在反序列化时，如果serialVersionUID被序列化，则反序列化时会失败</li>
<li>当一个对象的实例变量引用其他对象，序列化改对象时，也把引用对象进行序列化</li>
<li>static,transient后的变量不能被序列化</li>
</ul>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2017/08/15/Single_Prevent_being_reflected/">防止单例模式被反射攻击</a><a class="next" href="/2017/08/15/Gradle_new_posture/">Gradle 依赖新姿势</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/">京ICP备17062560号</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>