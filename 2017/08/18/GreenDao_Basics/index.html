<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="不知道描述啥"><title>greenDAO 入门基础 | Sing</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">greenDAO 入门基础</h1><a id="logo" href="/.">Sing</a><p class="description">笔记</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined"> 首页</i></a><a href="/django"><i class="fa undefined"> Django</i></a><a href="/html_css"><i class="fa undefined"> Html_css</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySql/">MySql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/11/MySql_Linux_install_mysql/">Linux 环境下安装MySql</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/29/Python_crawler/">用 Python 编写一个简单的爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/19/Android_CountDownTimer/">CountDownTimer的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/05/Android_decompile/">Android 反编译</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/01/Android_dialog_shadow/">Android 使用Dialog时状态栏变黑的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/21/Python_Django_simple_server/">基于 Python 的简单服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/21/Android_about_image/">Android 图片相关操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/16/DesignPattern_01_Principle/">《设计模式》走向灵活软件之路--面向对象的六大原则</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/13/MySql-17_indexes/">MySql_17 MySQL中的索引</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/10/Android_Application_Analysis/">Application 全面解析</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">greenDAO 入门基础</h1><div class="post-meta">Aug 18, 2017<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span></div><div class="post-content"><p>greenDAO是一个将对象映射到SQLite数据库中的轻量且快速的ORM解决方案。<br>关于greenDAO可以看官网 <a href="http://greenrobot.org/greendao/" target="_blank" rel="noopener">官网地址</a>  </p>
<p><a href="https://github.com/greenrobot/greenDAO">github地址</a></p>
<p>greenDAO 优势</p>
<ul>
<li>一个精简的库</li>
<li>性能最大化</li>
<li>内存开销最小化</li>
<li>易于使用的 APIs</li>
<li>对 Android 进行高度优化</li>
</ul>
<p>首先，我们先简单集成 greenDAO:</p>
<h4 id="1、在项目的-build-gradle-中加入远程仓库及插件："><a href="#1、在项目的-build-gradle-中加入远程仓库及插件：" class="headerlink" title="1、在项目的 build.gradle 中加入远程仓库及插件："></a>1、在项目的 build.gradle 中加入远程仓库及插件：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        jcenter()</span><br><span class="line">        mavenCentral() // add repository</span><br><span class="line">    &#125;</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        classpath 'com.android.tools.build:gradle:2.3.3'</span><br><span class="line">        classpath 'org.greenrobot:greendao-gradle-plugin:3.2.2' // add plugin</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2、在-module-中的-build-gradle-中顶部引入插件，然后加入-library-依赖："><a href="#2、在-module-中的-build-gradle-中顶部引入插件，然后加入-library-依赖：" class="headerlink" title="2、在 module 中的 build.gradle 中顶部引入插件，然后加入 library 依赖："></a>2、在 module 中的 build.gradle 中顶部引入插件，然后加入 library 依赖：</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: 'com.android.application'</span><br><span class="line">apply plugin: 'org.greenrobot.greendao' // apply plugin</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    compile fileTree(dir: 'libs', include: ['*.jar'])</span><br><span class="line">    compile 'com.android.support:appcompat-v7:26.+'</span><br><span class="line"></span><br><span class="line">    compile 'org.greenrobot:greendao:3.2.0' // add library</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们<code>Sync Now</code>之后就集成完成，当然我们还需要配置一下相关路径</p>
<h4 id="3、自定义路径"><a href="#3、自定义路径" class="headerlink" title="3、自定义路径"></a>3、自定义路径</h4><p>在 module 中的 build.gradle 中最外层加入如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">greendao &#123;</span><br><span class="line">    schemaVersion 1</span><br><span class="line">    daoPackage 'sing.greendao.db'</span><br><span class="line">    targetGenDir 'src/main/java'</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>schemaVersion，指定数据库schema版本号，升级等操作会用到</li>
<li>daoPackage，dao的包名，包名默认是entity所在的包</li>
<li>targetGenDir，生成数据库文件的目录</li>
</ul>
<h4 id="4、创建一个实体类-User"><a href="#4、创建一个实体类-User" class="headerlink" title="4、创建一个实体类 User"></a>4、创建一个实体类 User</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span>  </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们在工具栏中找到 <code>Build</code>–&gt;<code>Make Module &#39;app&#39;</code>，执行之后可以看到在我们指定的路径下会生成3个类：<br><img src="http://oupjofqw3.bkt.clouddn.com/android_greendao_0001.png" alt=""></p>
<h4 id="5、greenDAO的使用"><a href="#5、greenDAO的使用" class="headerlink" title="5、greenDAO的使用"></a>5、greenDAO的使用</h4><p>首先在 Application 中初始化并提供 DaoSession 的获取方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DaoSession daoSession;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// greenDAO 3.0之后提供了本地数据加密，但加密会增加APK体积，视情况而选择</span></span><br><span class="line">        <span class="comment">// 加密写法</span></span><br><span class="line">        <span class="comment">// DaoMaster.DevOpenHelper helper = new DaoMaster.DevOpenHelper(this, "notes-db-encrypted");</span></span><br><span class="line">        <span class="comment">// Database db = helper.getEncryptedWritableDb("super-secret");</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 不加密写法</span></span><br><span class="line">        DaoMaster.DevOpenHelper helper = <span class="keyword">new</span> DaoMaster.DevOpenHelper(<span class="keyword">this</span>, <span class="string">"notes-db"</span>);</span><br><span class="line">        Database db = helper.getWritableDb();  </span><br><span class="line">        </span><br><span class="line">        daoSession = <span class="keyword">new</span> DaoMaster(db).newSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DaoSession <span class="title">getDaoSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> daoSession;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">当我们使用的时候，在 Acticity 中首先要通过 DaoSession 获取到 UserDao：</span><br><span class="line"></span><br><span class="line">```JAVA</span><br><span class="line">DaoSession daoSession = ((App) getApplication()).getDaoSession();</span><br><span class="line">UserDao dao = daoSession.getUserDao();</span><br></pre></td></tr></table></figure>
<ul>
<li>增加数据：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setAge(Integer.valueOf(age));</span><br><span class="line">user.setName(name);</span><br><span class="line">dao.insert(user);</span><br></pre></td></tr></table></figure>
<ul>
<li>删除数据：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User user = list.get(position);</span><br><span class="line">Long noteId = user.getId();</span><br><span class="line">dao.deleteByKey(noteId);</span><br><span class="line"><span class="comment">// dao.delete(user);</span></span><br></pre></td></tr></table></figure>
<ul>
<li>修改数据：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User user = list.get(position);</span><br><span class="line">user.setName(name);</span><br><span class="line">user.setAge(Integer.valueOf(age));</span><br><span class="line">dao.update(user);</span><br></pre></td></tr></table></figure>
<ul>
<li>查询数据：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;User&gt; notes = notesQuery.list();</span><br><span class="line">List&lt;User&gt; notes = dao.loadAll();</span><br><span class="line">List&lt;User&gt; notes = dao.load(key);</span><br></pre></td></tr></table></figure>
<h4 id="6、greenDAO中的注解"><a href="#6、greenDAO中的注解" class="headerlink" title="6、greenDAO中的注解"></a>6、greenDAO中的注解</h4><ul>
<li>@Entity 定义实体<br>　　@nameInDb 在数据库中的名字，如不写则为实体中类名<br>　　@indexes 索引<br>　　@createInDb 是否创建表，默认为true,false时不创建<br>　　@schema 指定架构名称为实体<br>　　@active 无论是更新生成都刷新</li>
<li>@Id</li>
<li>@NotNull 不为null</li>
<li>@Unique 唯一约束</li>
<li>@ToMany 一对多</li>
<li>@OrderBy 排序</li>
<li>@ToOne 一对一</li>
<li>@Transient 不存储在数据库中</li>
<li>@generated 由greendao产生的构造函数或方法</li>
</ul>
<h4 id="7、API"><a href="#7、API" class="headerlink" title="7、API"></a>7、API</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">attachEntity</span><span class="params">(T entity)</span>：</span></span><br><span class="line"><span class="function">	</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> 	<span class="title">count</span><span class="params">()</span>：获取数据库中数据的数量</span></span><br><span class="line"><span class="function">	</span></span><br><span class="line"><span class="function"><span class="comment">// 数据删除相关</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">delete</span><span class="params">(T entity)</span>：从数据库中删除给定的实体</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">deleteAll</span><span class="params">()</span> ：删除数据库中全部数据</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">deleteByKey</span><span class="params">(K key)</span>：从数据库中删除给定Key所对应的实体</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">deleteByKeyInTx</span><span class="params">(java.lang.Iterable&lt;K&gt; keys)</span>：使用事务操作删除数据库中给定的所有key所对应的实体</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">deleteByKeyInTx</span><span class="params">(K... keys)</span>：使用事务操作删除数据库中给定的所有key所对应的实体</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">deleteInTx</span><span class="params">(java.lang.Iterable&lt;T&gt; entities)</span>：使用事务操作删除数据库中给定实体集合中的实体</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">deleteInTx</span><span class="params">(T... entities)</span>：使用事务操作删除数据库中给定的实体</span></span><br><span class="line"><span class="function">	</span></span><br><span class="line"><span class="function"><span class="comment">// 数据插入相关</span></span></span><br><span class="line"><span class="function"><span class="keyword">long</span> 	<span class="title">insert</span><span class="params">(T entity)</span>：将给定的实体插入数据库</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">insertInTx</span><span class="params">(java.lang.Iterable&lt;T&gt; entities)</span>：使用事务操作，将给定的实体集合插入数据库</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">insertInTx</span><span class="params">(java.lang.Iterable&lt;T&gt; entities, <span class="keyword">boolean</span> setPrimaryKey)</span>：使用事务操作，将给定的实体集合插入数据库，并设置是否设定主键</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">insertInTx</span><span class="params">(T... entities)</span>：将给定的实体插入数据库</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> 	<span class="title">insertOrReplace</span><span class="params">(T entity)</span>：将给定的实体插入数据库，若此实体类存在，则覆盖</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">insertOrReplaceInTx</span><span class="params">(java.lang.Iterable&lt;T&gt; entities)</span>：使用事务操作，将给定的实体插入数据库，若此实体类存在，则覆盖</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">insertOrReplaceInTx</span><span class="params">(java.lang.Iterable&lt;T&gt; entities, <span class="keyword">boolean</span> setPrimaryKey)</span>：使用事务操作，将给定的实体插入数据库，若此实体类存在，则覆盖并设置是否设定主键</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">insertOrReplaceInTx</span><span class="params">(T... entities)</span>：使用事务操作，将给定的实体插入数据库，若此实体类存在，则覆盖</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> 	<span class="title">insertWithoutSettingPk</span><span class="params">(T entity)</span>：将给定的实体插入数据库,但不设定主键</span></span><br><span class="line"><span class="function">	</span></span><br><span class="line"><span class="function"><span class="comment">// 新增数据插入相关API</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">save</span><span class="params">(T entity)</span>：将给定的实体插入数据库，若此实体类存在，则更新</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">saveInTx</span><span class="params">(java.lang.Iterable&lt;T&gt; entities)</span>：将给定的实体插入数据库，若此实体类存在，则更新</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">saveInTx</span><span class="params">(T... entities)</span>：使用事务操作，将给定的实体插入数据库，若此实体类存在，则更新</span></span><br><span class="line"><span class="function">	</span></span><br><span class="line"><span class="function"><span class="comment">// 加载相关</span></span></span><br><span class="line"><span class="function">T 	<span class="title">load</span><span class="params">(K key)</span>：加载给定主键的实体</span></span><br><span class="line"><span class="function">java.util.List&lt;T&gt; 	<span class="title">loadAll</span><span class="params">()</span>：加载数据库中所有的实体</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> java.util.List&lt;T&gt; 	<span class="title">loadAllAndCloseCursor</span><span class="params">(android.database.Cursor cursor)</span> ：从cursor中读取、返回实体的列表，并关闭该cursor</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> java.util.List&lt;T&gt; 	<span class="title">loadAllFromCursor</span><span class="params">(android.database.Cursor cursor)</span>：从cursor中读取、返回实体的列表</span></span><br><span class="line"><span class="function">T 	<span class="title">loadByRowId</span><span class="params">(<span class="keyword">long</span> rowId)</span> ：加载某一行并返回该行的实体</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> T 	<span class="title">loadUnique</span><span class="params">(android.database.Cursor cursor)</span> ：从cursor中读取、返回唯一实体</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> T 	<span class="title">loadUniqueAndCloseCursor</span><span class="params">(android.database.Cursor cursor)</span> ：从cursor中读取、返回唯一实体，并关闭该cursor</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">//更新数据</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">update</span><span class="params">(T entity)</span> ：更新给定的实体</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> 	<span class="title">updateInsideSynchronized</span><span class="params">(T entity, DatabaseStatement stmt, <span class="keyword">boolean</span> lock)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> 	<span class="title">updateInsideSynchronized</span><span class="params">(T entity, android.database.sqlite.SQLiteStatement stmt, <span class="keyword">boolean</span> lock)</span> </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">updateInTx</span><span class="params">(java.lang.Iterable&lt;T&gt; entities)</span> ：使用事务操作，更新给定的实体</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> 	<span class="title">updateInTx</span><span class="params">(T... entities)</span>：使用事务操作，更新给定的实体</span></span><br></pre></td></tr></table></figure>
<h4 id="8、封装"><a href="#8、封装" class="headerlink" title="8、封装"></a>8、封装</h4><p>我们换一种写法，在第4部做完之后不在 Application 中初始化，而在使用的时候进行初始化，我们创建 DbManager.java 来进行管理：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 进行数据库的管理</span></span><br><span class="line"><span class="comment"> * 1.创建数据库</span></span><br><span class="line"><span class="comment"> * 2.创建数据库表</span></span><br><span class="line"><span class="comment"> * 3.对数据库进行增删查改</span></span><br><span class="line"><span class="comment"> * 4.对数据库进行升级</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DbManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String DB_NAME = <span class="string">"dataa.db"</span>;<span class="comment">//数据库名称</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> DbManager mDaoManager;<span class="comment">//多线程访问</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DaoMaster.DevOpenHelper mHelper;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DaoMaster mDaoMaster;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DaoSession mDaoSession;</span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用单例模式获得操作数据库的对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DbManager <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DbManager instance = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (mDaoManager == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (DbManager.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> DbManager();</span><br><span class="line">                    mDaoManager = instance;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mDaoManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化Context对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DbManager <span class="title">init</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">        <span class="keyword">return</span> mDaoManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断数据库是否存在，如果不存在则创建</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DaoMaster <span class="title">getDaoMaster</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == mDaoMaster) &#123;</span><br><span class="line">            mHelper = <span class="keyword">new</span> DaoMaster.DevOpenHelper(context, DB_NAME, <span class="keyword">null</span>);</span><br><span class="line">            mDaoMaster = <span class="keyword">new</span> DaoMaster(mHelper.getWritableDatabase());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mDaoMaster;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 完成对数据库的增删查找</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DaoSession <span class="title">getDaoSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == mDaoSession) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == mDaoMaster) &#123;</span><br><span class="line">                mDaoMaster = getDaoMaster();</span><br><span class="line">            &#125;</span><br><span class="line">            mDaoSession = mDaoMaster.newSession();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mDaoSession;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置debug模式开启或关闭，默认关闭</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDebug</span><span class="params">(<span class="keyword">boolean</span> flag)</span> </span>&#123;</span><br><span class="line">        QueryBuilder.LOG_SQL = flag;</span><br><span class="line">        QueryBuilder.LOG_VALUES = flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭数据库</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeDataBase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        closeHelper();</span><br><span class="line">        closeDaoSession();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeDaoSession</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != mDaoSession) &#123;</span><br><span class="line">            mDaoSession.clear();</span><br><span class="line">            mDaoSession = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeHelper</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mHelper != <span class="keyword">null</span>) &#123;</span><br><span class="line">            mHelper.close();</span><br><span class="line">            mHelper = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们创建 BaseDao.java 来封装使用的增、删、改、查，而且在他的继承类中可以方便扩展：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseDao</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = BaseDao.class.getSimpleName();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> DUBUG = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">public</span> DbManager manager;</span><br><span class="line">    <span class="keyword">public</span> DaoSession daoSession;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BaseDao</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        manager = DbManager.getInstance().init(context);</span><br><span class="line">        daoSession = manager.getDaoSession();</span><br><span class="line">        manager.setDebug(DUBUG);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**************************数据库插入操作***********************/</span></span><br><span class="line">    <span class="comment">// 插入单个对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">insert</span><span class="params">(T object)</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            flag = manager.getDaoSession().insert(object) != -<span class="number">1</span> ? <span class="keyword">true</span>:<span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 插入多个对象，并开启新的线程</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">insert</span><span class="params">(<span class="keyword">final</span> List&lt;T&gt; objects)</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == objects || objects.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            manager.getDaoSession().runInTx(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">for</span> (T object : objects) &#123;</span><br><span class="line">                        manager.getDaoSession().insertOrReplace(object);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            flag = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, e.toString());</span><br><span class="line">            flag = <span class="keyword">false</span>;</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="comment">//            manager.CloseDataBase();</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**************************数据库更新操作***********************/</span></span><br><span class="line">    <span class="comment">// 以对象形式进行数据修改,其中必须要知道对象的主键ID</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">update</span><span class="params">(T object)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == object)&#123;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            manager.getDaoSession().update(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 批量更新数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(<span class="keyword">final</span> List&lt;T&gt; objects, Class clss)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == objects || objects.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            daoSession.getDao(clss).updateInTx(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">for</span>(T object:objects)&#123;</span><br><span class="line">                        daoSession.update(object);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**************************数据库删除操作***********************/</span></span><br><span class="line">    <span class="comment">// 删除某个数据库表</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">deleteTable</span><span class="params">(Class clss)</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            manager.getDaoSession().deleteAll(clss);</span><br><span class="line">            flag = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, e.toString());</span><br><span class="line">            flag = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 删除某个对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(T object)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            daoSession.delete(object);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 异步批量删除数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(<span class="keyword">final</span> List&lt;T&gt; objects, Class clss)</span></span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == objects || objects.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            daoSession.getDao(clss).deleteInTx(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">for</span>(T object:objects)&#123;</span><br><span class="line">                        daoSession.delete(object);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            flag = <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, e.toString());</span><br><span class="line">            flag = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据主键ID来删除</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(<span class="keyword">long</span> id,Class clss)</span></span>&#123;</span><br><span class="line">        daoSession.getDao(clss).deleteByKey(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**************************数据库查询操作***********************/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得某个表名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTableName</span><span class="params">(Class object)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> daoSession.getDao(object).getTablename();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询某个ID的对象是否存在</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isExitObject</span><span class="params">(<span class="keyword">long</span> id, Class object)</span></span>&#123;</span><br><span class="line">        QueryBuilder&lt;T&gt; qb = (QueryBuilder&lt;T&gt;) daoSession.getDao(object).queryBuilder();</span><br><span class="line">        qb.where(UserDao.Properties.Id.eq(id));<span class="comment">// 这里需要继承类来实现，这是例子</span></span><br><span class="line">        <span class="keyword">long</span> length = qb.buildCount().count();</span><br><span class="line">        <span class="keyword">return</span> length&gt;<span class="number">0</span> ? <span class="keyword">true</span>:<span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据主键ID来查询</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">queryById</span><span class="params">(<span class="keyword">long</span> id,Class object)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (T) daoSession.getDao(object).loadByRowId(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询某条件下的对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">queryObject</span><span class="params">(Class object,String where,String...params)</span></span>&#123;</span><br><span class="line">        Object obj = <span class="keyword">null</span>;</span><br><span class="line">        List&lt;T&gt; objects = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            obj = daoSession.getDao(object);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> == obj)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            objects = daoSession.getDao(object).queryRaw(where,params);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG, e.toString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> objects;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查询所有对象</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">queryAll</span><span class="params">(Class object)</span></span>&#123;</span><br><span class="line">        List&lt;T&gt; objects = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            objects = (List&lt;T&gt;) daoSession.getDao(object).loadAll();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            Log.e(TAG,e.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> objects;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/***************************关闭数据库*************************/</span></span><br><span class="line">    <span class="comment">// 关闭数据库一般在Odestory中使用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">closeDataBase</span><span class="params">()</span></span>&#123;</span><br><span class="line">        manager.closeDataBase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后我们所有的实现类都继承此类即可，需要重写的部分重写，比如简单的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">extends</span> <span class="title">BaseDao</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserDaoIml</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// 重写了此方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isExitObject</span><span class="params">(<span class="keyword">long</span> id, Class object)</span> </span>&#123;</span><br><span class="line">        QueryBuilder&lt;User&gt; qb = (QueryBuilder&lt;User&gt;) daoSession.getDao(object).queryBuilder();</span><br><span class="line">        qb.where(UserDao.Properties.Id.eq(id));</span><br><span class="line">        <span class="keyword">long</span> length = qb.buildCount().count();</span><br><span class="line">        <span class="keyword">return</span> length &gt; <span class="number">0</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们就可以在 Activity 中使用所以的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">UserDaoImpl userDaoIml = <span class="keyword">new</span> UserDaoImpl(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">userDaoImpl.insert(user);</span><br><span class="line">userDaoImpl.delete(user);</span><br><span class="line">userDaoImpl.update(user);</span><br><span class="line">userDaoImpl.queryAll(User.class)</span><br></pre></td></tr></table></figure>
<p>而且我们也封装了事务处理，支持批量操作，是不是很方便？  </p>
<p><img src="http://oupjofqw3.bkt.clouddn.com/android_greendao_0002.gif" alt="">  </p>
<p>由上我们增加了3条数据，然后我们将数据库导出查看：</p>
<p><img src="http://oupjofqw3.bkt.clouddn.com/android_greendao_0003.png" alt=""></p>
<p>然后我们演示一下更新和删除操作</p>
<p><img src="http://oupjofqw3.bkt.clouddn.com/android_greendao_0004.gif" alt=""></p>
<p><a href="https://github.com/Sing1/GreenDaoDemo/">demo下载地址</a></p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2017/08/22/MySql-09_table_update/">MySql_09 如何修改表</a><a class="next" href="/2017/08/18/MySql-08_table_add_view_delete/">MySql_08 数据表相关操作</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/">京ICP备17062560号</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>