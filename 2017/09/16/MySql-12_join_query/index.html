<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="不知道描述啥"><title>MySql_12 MySQL连接查询 | Sing</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">MySql_12 MySQL连接查询</h1><a id="logo" href="/.">Sing</a><p class="description">笔记</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined"> 首页</i></a><a href="/django"><i class="fa undefined"> Django</i></a><a href="/html_css"><i class="fa undefined"> Html_css</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">MySql_12 MySQL连接查询</h1><div class="post-meta">Sep 16, 2017<span> | </span><span class="category"><a href="/categories/MySql/">MySql</a></span></div><div class="post-content"><h3 id="1、什么是连接查询？"><a href="#1、什么是连接查询？" class="headerlink" title="1、什么是连接查询？"></a>1、什么是连接查询？</h3><p>连接查询是将两个或两个以上的表按某个条件连接起来，从中选取需要的数据。连接查询是同时查询两个或两个以上的表时使用的。当不同的表中存在相同意义的字段时，可以通过该字段连接这几个表</p>
<h3 id="2、内连接查询"><a href="#2、内连接查询" class="headerlink" title="2、内连接查询"></a>2、内连接查询</h3><p>内连接是用<code>JOIN</code>、<code>CROSS JOIN</code>或<code>INNER JOIN</code>通过ON连接来显示两个表中符合连接条件的记录，例如我们查询<code>cms_user</code>中的用户与<code>provinces</code>中的省份：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT u.id,u.username,u.email,u.sex,p.proName</span><br><span class="line">    -&gt; FROM cms_user AS u # 先任意选一张表</span><br><span class="line">    -&gt; INNER JOIN </span><br><span class="line">    -&gt; provinces AS p # 再查询省份表</span><br><span class="line">    -&gt; ON u.proId=p.id; # 通过id相同</span><br><span class="line">+<span class="comment">----+-----------+-------------+--------+---------+</span></span><br><span class="line">| id | username  | email       | sex    | proName |</span><br><span class="line">+<span class="comment">----+-----------+-------------+--------+---------+</span></span><br><span class="line">|  1 | 张三      | user@qq.com | 男     | 北京    |</span><br><span class="line">|  2 | 张三丰    | user@qq.com | 女     | 上海    |</span><br><span class="line">|  3 | 章子怡    | user@qq.com | 男     | 深圳    |</span><br><span class="line">|  4 | long      | user@qq.com | 女     | 广州    |</span><br><span class="line">|  5 | ring      | user@qq.com | 男     | 上海    |</span><br><span class="line">|  6 | queen     | user@qq.com | 女     | 深圳    |</span><br><span class="line">|  7 | sing      | user@qq.com | 男     | 重庆    |</span><br><span class="line">|  8 | blek      | user@qq.com | 女     | 北京    |</span><br><span class="line">|  9 | rose      | user@qq.com | 男     | 上海    |</span><br><span class="line">| 10 | lily      | user@qq.com | 女     | 上海    |</span><br><span class="line">| 11 | john      | user@qq.com | 保密   | 上海    |</span><br><span class="line">| 12 | test1     | user@qq.com | 保密   | 北京    |</span><br><span class="line">+<span class="comment">----+-----------+-------------+--------+---------+</span></span><br><span class="line">12 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"><span class="string">``</span><span class="string">` </span></span><br><span class="line"><span class="string">就测试一个，另两个是一样的，之前的查询条件等一样使用，比如上面的方法只查询性别为`</span>男<span class="string">`：</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">SQL</span></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> u.id,u.username,u.sex,p.proName </span><br><span class="line">    -&gt; <span class="keyword">FROM</span> cms_user <span class="keyword">AS</span> u</span><br><span class="line">    -&gt; <span class="keyword">JOIN</span> </span><br><span class="line">    -&gt; provinces <span class="keyword">AS</span> p</span><br><span class="line">    -&gt; <span class="keyword">ON</span> u.proId=p.id</span><br><span class="line">    -&gt; <span class="keyword">WHERE</span> u.sex=<span class="string">'男'</span>;</span><br><span class="line">+<span class="comment">----+-----------+------+---------+</span></span><br><span class="line">| id | username  | sex  | proName |</span><br><span class="line">+<span class="comment">----+-----------+------+---------+</span></span><br><span class="line">|  1 | 张三      | 男   | 北京    |</span><br><span class="line">|  3 | 章子怡    | 男   | 深圳    |</span><br><span class="line">|  5 | ring      | 男   | 上海    |</span><br><span class="line">|  7 | sing      | 男   | 重庆    |</span><br><span class="line">|  9 | rose      | 男   | 上海    |</span><br><span class="line">+<span class="comment">----+-----------+------+---------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>来一个完整型的查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT u.id,u.username,u.sex,p.proName,COUNT(*) AS totalUsers,GROUP_CONCAT(username)</span><br><span class="line">    -&gt; FROM cms_user AS u</span><br><span class="line">    -&gt; JOIN </span><br><span class="line">    -&gt; provinces AS p</span><br><span class="line">    -&gt; ON u.proId=p.id</span><br><span class="line">    -&gt; WHERE u.sex='男'</span><br><span class="line">    -&gt; GROUP BY p.proName</span><br><span class="line">    -&gt; HAVING COUNT(*)&gt;=1</span><br><span class="line">    -&gt; ORDER BY u.id ASC</span><br><span class="line">    -&gt; LIMIT 0,2;</span><br><span class="line">+<span class="comment">----+-----------+------+---------+------------+------------------------+</span></span><br><span class="line">| id | username  | sex  | proName | totalUsers | GROUP_CONCAT(username) |</span><br><span class="line">+<span class="comment">----+-----------+------+---------+------------+------------------------+</span></span><br><span class="line">|  1 | 张三      | 男   | 北京    |          1 | 张三                   |</span><br><span class="line">|  3 | 章子怡    | 男   | 深圳    |          1 | 章子怡                 |</span><br><span class="line">+<span class="comment">----+-----------+------+---------+------------+------------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<p>又例如，查询<code>cms_news</code>中的<code>id</code>、<code>title</code>,查询<code>cms_cate</code>中的<code>cateName</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT n.id,n.title,c.cateName FROM </span><br><span class="line">    -&gt; cms_news AS n</span><br><span class="line">    -&gt; JOIN </span><br><span class="line">    -&gt; cms_cate AS c</span><br><span class="line">    -&gt; ON n.cId=c.id;</span><br><span class="line">+<span class="comment">----+-------------------------------------------------------------+--------------+</span></span><br><span class="line">| id | title                                                       | cateName     |</span><br><span class="line">+<span class="comment">----+-------------------------------------------------------------+--------------+</span></span><br><span class="line">|  1 | 亚航客机失联搜救尚无线索 未发求救信号                       | 国内新闻     |</span><br><span class="line">|  2 | 北京新开通四条地铁线路 迎接首位客人                         | 国际新闻     |</span><br><span class="line">|  3 | 考研政治题多次出现习近平讲话内容                            | 体育新闻     |</span><br><span class="line">|  4 | 深度-曾雪麟：佩兰别重蹈卡马乔覆辙                           | 国际新闻     |</span><br><span class="line">|  5 | 国产JAD-1手枪枪架投入使用 手枪可变"冲锋枪"                  | 军事新闻     |</span><br><span class="line">|  6 | 测试数据1                                                   | 国内新闻     |</span><br><span class="line">|  7 | 测试数据2                                                   | 国内新闻     |</span><br><span class="line">|  8 | 测试数据3                                                   | 国内新闻     |</span><br><span class="line">+<span class="comment">----+-------------------------------------------------------------+--------------+</span></span><br><span class="line">8 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<p>如果要查询新闻的<code>id</code>、<code>title</code>、<code>cateName</code>、<code>username</code>、<code>role</code>,那么涉及到了三张表<code>新闻表</code>、<code>分类表</code>、<code>用户表</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT n.id,n.title,c.cateName,a.username,a.role</span><br><span class="line">    -&gt; FROM cms_cate AS c</span><br><span class="line">    -&gt; JOIN </span><br><span class="line">    -&gt; cms_news AS n</span><br><span class="line">    -&gt; ON n.cId=c.id</span><br><span class="line">    -&gt; JOIN </span><br><span class="line">    -&gt; cms_admin AS a</span><br><span class="line">    -&gt; ON n.aId=a.id;</span><br><span class="line">+<span class="comment">----+-------------------------------------------------------------+--------------+----------+-----------------+</span></span><br><span class="line">| id | title                                                       | cateName     | username | role            |</span><br><span class="line">+<span class="comment">----+-------------------------------------------------------------+--------------+----------+-----------------+</span></span><br><span class="line">|  1 | 亚航客机失联搜救尚无线索 未发求救信号                       | 国内新闻     | sing     | 普通管理员      |</span><br><span class="line">|  2 | 北京新开通四条地铁线路 迎接首位客人                         | 国际新闻     | admin    | 超级管理员      |</span><br><span class="line">|  3 | 考研政治题多次出现习近平讲话内容                            | 体育新闻     | sing     | 普通管理员      |</span><br><span class="line">|  4 | 深度-曾雪麟：佩兰别重蹈卡马乔覆辙                           | 国际新闻     | test     | 普通管理员      |</span><br><span class="line">|  5 | 国产JAD-1手枪枪架投入使用 手枪可变"冲锋枪"                  | 军事新闻     | test     | 普通管理员      |</span><br><span class="line">+<span class="comment">----+-------------------------------------------------------------+--------------+----------+-----------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="3、外连接查询"><a href="#3、外连接查询" class="headerlink" title="3、外连接查询"></a>3、外连接查询</h3><p>首先我们看下省份表的数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM provinces;</span><br><span class="line">+<span class="comment">----+---------+</span></span><br><span class="line">| id | proName |</span><br><span class="line">+<span class="comment">----+---------+</span></span><br><span class="line">|  2 | 上海    |</span><br><span class="line">|  1 | 北京    |</span><br><span class="line">|  4 | 广州    |</span><br><span class="line">|  3 | 深圳    |</span><br><span class="line">|  5 | 重庆    |</span><br><span class="line">+<span class="comment">----+---------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br></pre></td></tr></table></figure>
<p>可以看到有5条数据，加入我们插入一条错误数据，比如用户的<code>proId</code>不在此表内：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT cms_user(username,password,regTime,proId)</span><br><span class="line">    -&gt; VALUES('TEST2','TEST2','1381203974',20);</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>然后我们查询这条数据是插入成功的，但是通过内连接查询永远也查不出来，因为这是条错误数据，这条数据是不应该插入成功的，可以通过外键来控制。  </p>
<h4 id="1、左外连接"><a href="#1、左外连接" class="headerlink" title="1、左外连接"></a>1、左外连接</h4><p>LEFT [OUTER] JOIN，显示左表的全部记录及右表符合连接条件的记录</p>
<h4 id="2、右外连接"><a href="#2、右外连接" class="headerlink" title="2、右外连接"></a>2、右外连接</h4><p>RIGHT [OUTER] JOIN，显示右表的全部记录以及左表符合条件的记录  </p>
<h5 id="首先测试一下左外连接："><a href="#首先测试一下左外连接：" class="headerlink" title="首先测试一下左外连接："></a>首先测试一下<code>左外连接</code>：</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT u.id,u.username,u.email,u.sex,p.proName</span><br><span class="line">    -&gt; FROM cms_user AS u</span><br><span class="line">    -&gt; LEFT JOIN provinces AS p</span><br><span class="line">    -&gt; ON u.proId=p.id;</span><br><span class="line">+<span class="comment">----+-----------+-------------+--------+---------+</span></span><br><span class="line">| id | username  | email       | sex    | proName |</span><br><span class="line">+<span class="comment">----+-----------+-------------+--------+---------+</span></span><br><span class="line">|  1 | 张三      | user@qq.com | 男     | 北京    |</span><br><span class="line">|  2 | 张三丰    | user@qq.com | 女     | 上海    |</span><br><span class="line">|  3 | 章子怡    | user@qq.com | 男     | 深圳    |</span><br><span class="line">|  4 | long      | user@qq.com | 女     | 广州    |</span><br><span class="line">|  5 | ring      | user@qq.com | 男     | 上海    |</span><br><span class="line">|  6 | queen     | user@qq.com | 女     | 深圳    |</span><br><span class="line">|  7 | sing      | user@qq.com | 男     | 重庆    |</span><br><span class="line">|  8 | blek      | user@qq.com | 女     | 北京    |</span><br><span class="line">|  9 | rose      | user@qq.com | 男     | 上海    |</span><br><span class="line">| 10 | lily      | user@qq.com | 女     | 上海    |</span><br><span class="line">| 11 | john      | user@qq.com | 保密   | 上海    |</span><br><span class="line">| 12 | test1     | user@qq.com | 保密   | 北京    |</span><br><span class="line">| 13 | TEST2     | user@qq.com | NULL   | NULL    |</span><br><span class="line">+<span class="comment">----+-----------+-------------+--------+---------+</span></span><br><span class="line">13 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>上面这条查询为左表连接查询，首先查询<code>LEFT JOIN</code>左边的表的全部记录，也就是<code>cms_user</code>为主表，会查询到所以记录，然后在右表条件不符合的会用<code>NULL</code>代替，所以可以看到<code>TEST2</code>这条记录，那么互换一下表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT u.id,u.username,u.email,u.sex,p.proName</span><br><span class="line">    -&gt; FROM provinces AS p</span><br><span class="line">    -&gt; LEFT JOIN cms_user AS u</span><br><span class="line">    -&gt; ON u.proId=p.id;</span><br><span class="line">+<span class="comment">------+-----------+-------------+--------+---------+</span></span><br><span class="line">| id   | username  | email       | sex    | proName |</span><br><span class="line">+<span class="comment">------+-----------+-------------+--------+---------+</span></span><br><span class="line">|    1 | 张三      | user@qq.com | 男     | 北京    |</span><br><span class="line">|    2 | 张三丰    | user@qq.com | 女     | 上海    |</span><br><span class="line">|    3 | 章子怡    | user@qq.com | 男     | 深圳    |</span><br><span class="line">|    4 | long      | user@qq.com | 女     | 广州    |</span><br><span class="line">|    5 | ring      | user@qq.com | 男     | 上海    |</span><br><span class="line">|    6 | queen     | user@qq.com | 女     | 深圳    |</span><br><span class="line">|    7 | sing      | user@qq.com | 男     | 重庆    |</span><br><span class="line">|    8 | blek      | user@qq.com | 女     | 北京    |</span><br><span class="line">|    9 | rose      | user@qq.com | 男     | 上海    |</span><br><span class="line">|   10 | lily      | user@qq.com | 女     | 上海    |</span><br><span class="line">|   11 | john      | user@qq.com | 保密   | 上海    |</span><br><span class="line">|   12 | test1     | user@qq.com | 保密   | 北京    |</span><br><span class="line">+<span class="comment">------+-----------+-------------+--------+---------+</span></span><br><span class="line">12 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>由此看到，首先查询到了<code>provinces</code>中的所有数据，只有5条，所以是查不到<code>TEST2</code>这条数据的。<br>那么右外连接是相同的，与左外连接正好相反：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> u.id,u.username,u.email,u.sex,p.proName</span><br><span class="line"><span class="keyword">FROM</span> provinces <span class="keyword">AS</span> p</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> cms_user <span class="keyword">AS</span> u</span><br><span class="line"><span class="keyword">ON</span> u.proId=p.id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> u.id,u.username,u.email,u.sex,p.proName</span><br><span class="line"><span class="keyword">FROM</span> provinces <span class="keyword">AS</span> p</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> cms_user <span class="keyword">AS</span> u</span><br><span class="line"><span class="keyword">ON</span> u.proId=p.id;</span><br></pre></td></tr></table></figure>
<p>=============<br><a href="http://www.maiziedu.com/course/306-3378/" target="_blank" rel="noopener">http://www.maiziedu.com/course/306-3378/</a></p>
<h3 id="4、外键"><a href="#4、外键" class="headerlink" title="4、外键"></a>4、外键</h3><p>外键是表的一个特殊字段。被参照的表是主表，外键所在字段的表为子表。设置外键的原则需要记住，就是依赖于数据库中已存在的表的主键。外键的作用是建立该表与其父表的关联关系。父表中对记录做操作时，子表中与之对应的信息也应有相应的改变。  </p>
<h5 id="外键的作用保持数据的一致性和完整性，可以实现一对一或一对多的关系。"><a href="#外键的作用保持数据的一致性和完整性，可以实现一对一或一对多的关系。" class="headerlink" title="外键的作用保持数据的一致性和完整性，可以实现一对一或一对多的关系。"></a>外键的作用保持数据的一致性和完整性，可以实现一对一或一对多的关系。</h5><h5 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h5><ul>
<li>父表和子表必须使用相同的存储引擎，而且禁止使用临时表。   </li>
<li>数据表的存储引擎只能为InnoDB。  </li>
<li>外键列和参照列必须具有相似的数据类型。其中数字的长度或是否有符号位必须相同；而字符的长度则可以不同。  </li>
<li>外键列和参照列必须创建索引。如果外键列不存在索引的话，MySQL将自动创建索引。 </li>
</ul>
<h5 id="外键约束的参照操作"><a href="#外键约束的参照操作" class="headerlink" title="外键约束的参照操作"></a>外键约束的参照操作</h5><ul>
<li>CASCADE：从父表删除或更新且自动删除或更新子表中匹配的行。  </li>
<li>SET NULL：从父表删除或更新行，并设置子表中的外键列为NULL。如果使用该选项，必须保证子表列没有指定NOT NULL。  </li>
<li>RESTRICT：拒绝对父表的删除或更新操作。  </li>
<li>NO ACTION：标准SQL的关键字，在MySQL中与RESTRICT相同。</li>
</ul>
<p>比如，某公司的组成，一定是先有部门再有员工，那么部门为主表，员工表为子表，首先创建主表<code>部门表</code>并插入几条数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS department(</span><br><span class="line">    -&gt; id TINYINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; depName VARCHAR(20) NOT NULL UNIQUE</span><br><span class="line">    -&gt; )ENGINE=INNODB;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT department(depName) VALUES('教学部'),</span><br><span class="line">    -&gt; ('市场部'),</span><br><span class="line">    -&gt; ('运营部'),</span><br><span class="line">    -&gt; ('督导部');</span><br><span class="line">Query OK, 4 rows affected (0.00 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>然后我们创建子表<code>员工表</code>并插入几条数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS employee(</span><br><span class="line">    -&gt; id SMALLINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; username VARCHAR(20) NOT NULL UNIQUE,</span><br><span class="line">    -&gt; depId TINYINT UNSIGNED</span><br><span class="line">    -&gt; )ENGINE=INNODB;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT employee(username,depId) VALUES('king',1),</span><br><span class="line">    -&gt; ('queen',2),</span><br><span class="line">    -&gt; ('张三',3),</span><br><span class="line">    -&gt; ('李四',4),</span><br><span class="line">    -&gt; ('王五',1);</span><br><span class="line">Query OK, 5 rows affected (0.00 sec)</span><br><span class="line">Records: 5  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>此时两张表是管理的，如果我们删除直接<code>督导部</code>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> department <span class="keyword">WHERE</span> depName=<span class="string">'督导部'</span>;</span><br></pre></td></tr></table></figure>
<p>此时是可以成功的，而且也删除掉了，但是我们的员工表中还有一条数据存在于<code>督导部</code>中，很明显不合理，应该先把该部门下的人删除或修改别的部门再删除，或者用我们的外键<code>FOREIGN KEY</code>和<code>REFERENCES</code>来操作，先删除之前的表，并创建：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DROP TABLE employee,department;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS department(</span><br><span class="line">    -&gt; id TINYINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; depName VARCHAR(20) NOT NULL UNIQUE</span><br><span class="line">    -&gt; )ENGINE=INNODB; # 一定要先创建主表</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">    </span><br><span class="line">mysql&gt; INSERT department(depName) VALUES('教学部'),</span><br><span class="line">    -&gt; ('市场部'),</span><br><span class="line">    -&gt; ('运营部'),</span><br><span class="line">    -&gt; ('督导部');</span><br><span class="line">Query OK, 4 rows affected (0.00 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS employee(</span><br><span class="line">    -&gt; id SMALLINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; username VARCHAR(20) NOT NULL UNIQUE,</span><br><span class="line">    -&gt; depId TINYINT UNSIGNED,</span><br><span class="line">    -&gt; FOREIGN KEY(depId) REFERENCES department(id)# 外键depId，参照部门表的id</span><br><span class="line">    -&gt; )ENGINE=INNODB;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec) </span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT employee(username,depId) VALUES('king',1),</span><br><span class="line">    -&gt; ('queen',2),</span><br><span class="line">    -&gt; ('张三',3),</span><br><span class="line">    -&gt; ('李四',4),</span><br><span class="line">    -&gt; ('王五',1);</span><br><span class="line">Query OK, 5 rows affected (0.00 sec)</span><br><span class="line">Records: 5  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>然后我们查看一下表结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DESC employee;</span><br><span class="line">+<span class="comment">----------+----------------------+------+-----+---------+----------------+</span></span><br><span class="line">| Field    | Type                 | Null | Key | Default | Extra          |</span><br><span class="line">+<span class="comment">----------+----------------------+------+-----+---------+----------------+</span></span><br><span class="line">| id       | smallint(5) unsigned | NO   | PRI | NULL    | auto_increment |</span><br><span class="line">| username | varchar(20)          | NO   | UNI | NULL    |                |</span><br><span class="line">| depId    | tinyint(3) unsigned  | YES  | MUL | NULL    |                |</span><br><span class="line">+<span class="comment">----------+----------------------+------+-----+---------+----------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>我们可以看到在<code>depId</code>中KEY已经添加了<code>MUL</code>，再看一下创建表的详细信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW CREATE TABLE employee;</span><br><span class="line">+<span class="comment">----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table    | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                                                                                                                                                |</span><br><span class="line">+<span class="comment">----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| employee | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`employee`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`depId`</span> tinyint(<span class="number">3</span>) <span class="keyword">unsigned</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`username`</span> (<span class="string">`username`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`depId`</span> (<span class="string">`depId`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`employee_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`depId`</span>) <span class="keyword">REFERENCES</span> <span class="string">`department`</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</span><br><span class="line">+<span class="comment">----------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>可以看到系统默认添加了外键<code>employee_ibfk_1</code>，这个在删除外键的时候用，我们先删除一下主表的一条数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM department WHERE id=1;</span><br><span class="line">ERROR 1451 (23000): Cannot <span class="keyword">delete</span> <span class="keyword">or</span> <span class="keyword">update</span> a <span class="keyword">parent</span> <span class="keyword">row</span>: a foreign <span class="keyword">key</span> <span class="keyword">constraint</span> fails (<span class="string">`cms`</span>.<span class="string">`employee`</span>, <span class="keyword">CONSTRAINT</span> <span class="string">`employee_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`depId`</span>) <span class="keyword">REFERENCES</span> <span class="string">`department`</span> (<span class="string">`id`</span>))</span><br></pre></td></tr></table></figure>
<p>很明显1部门下有员工，所以必须先删除该部门下的员工才可以删除该表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  DELETE FROM employee WHERE depId=1;</span><br><span class="line">Query OK, 2 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; DELETE FROM department WHERE id=1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>如果我们再出入一条数据，那么这个员工必须是已有的部门下，比如插入一条错误数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; INSERT employee(username,depId) VALUES('test',11);</span><br><span class="line">ERROR 1452 (23000): Cannot add or <span class="keyword">update</span> a <span class="keyword">child</span> <span class="keyword">row</span>: a foreign <span class="keyword">key</span> <span class="keyword">constraint</span> fails (<span class="string">`cms`</span>.<span class="string">`employee`</span>, <span class="keyword">CONSTRAINT</span> <span class="string">`employee_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`depId`</span>) <span class="keyword">REFERENCES</span> <span class="string">`department`</span> (<span class="string">`id`</span>))</span><br></pre></td></tr></table></figure>
<p>该语句是没有任务错误，如果没有外键约束也可以成功的。</p>
<h5 id="外键的指定与删除"><a href="#外键的指定与删除" class="headerlink" title="外键的指定与删除"></a>外键的指定与删除</h5><p>我们可以在创建表的时候通过<code>CONSTRAINT</code>指定外键名称，而外键的名字我们可以用<code>主表名简写_fk_子表名简写</code>来命名更清晰的看到谁是主表谁是子表，首先删除<code>employee</code>并重新创建：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  DROP TABLE employee;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS employee(</span><br><span class="line">    -&gt; id SMALLINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; username VARCHAR(20) NOT NULL UNIQUE,</span><br><span class="line">    -&gt; depId TINYINT UNSIGNED,</span><br><span class="line">    -&gt; CONSTRAINT emp_fk_dep FOREIGN KEY(depId) REFERENCES department(id)</span><br><span class="line">    -&gt; )ENGINE=INNODB;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure>
<p>可以通过<code>SHOW CREATE TABLE employee;</code>来查看建表是的详细信息中外键名就是我们指定的名称，那么如何删除外键？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE employee DROP FOREIGN KEY emp_fk_dep;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>此时已经成功删除，可以通过表的详细定义查看，那么又如何动态添加外键？</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; ALTER TABLE employee ADD CONSTRAINT emp_fk_dep FOREIGN KEY(depId) REFERENCES department(id);</span><br><span class="line">Query OK, 5 rows affected (0.08 sec)</span><br><span class="line">Records: 5  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>成功之后同样可以通过表的详细定义查看外键。  </p>
<h5 id="CASCADE"><a href="#CASCADE" class="headerlink" title="CASCADE"></a>CASCADE</h5><p>当删除父表中的记录，子表中的与之对应的外键列也会被删除，首先删除之前的表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DROP TABLE employee,department;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS department(</span><br><span class="line">    -&gt; id TINYINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; depName VARCHAR(20) NOT NULL UNIQUE</span><br><span class="line">    -&gt; )ENGINE=INNODB;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; INSERT department(depName) VALUES('教学部'),</span><br><span class="line">    -&gt; ('市场部'),</span><br><span class="line">    -&gt; ('运营部'),</span><br><span class="line">    -&gt; ('督导部');</span><br><span class="line">Query OK, 4 rows affected (0.00 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS employee(</span><br><span class="line">    -&gt; id SMALLINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; username VARCHAR(20) NOT NULL UNIQUE,</span><br><span class="line">    -&gt; depId TINYINT UNSIGNED,</span><br><span class="line">    -&gt; FOREIGN KEY(depId) REFERENCES department(id) ON DELETE CASCADE</span><br><span class="line">    -&gt; )ENGINE=INNODB;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; INSERT employee(username,depId) VALUES('king',1),</span><br><span class="line">    -&gt; ('queen',2),</span><br><span class="line">    -&gt; ('张三',3),</span><br><span class="line">    -&gt; ('李四',4),</span><br><span class="line">    -&gt; ('王五',1);</span><br><span class="line">Query OK, 5 rows affected (0.00 sec)</span><br><span class="line">Records: 5  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>看一下建表的详细信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW CREATE TABLE employee;</span><br><span class="line">+<span class="comment">----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table    | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                                                                                                                                                                                   |</span><br><span class="line">+<span class="comment">----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| employee | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`employee`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`depId`</span> tinyint(<span class="number">3</span>) <span class="keyword">unsigned</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`username`</span> (<span class="string">`username`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`depId`</span> (<span class="string">`depId`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`employee_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`depId`</span>) <span class="keyword">REFERENCES</span> <span class="string">`department`</span> (<span class="string">`id`</span>) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">6</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</span><br><span class="line">+<span class="comment">----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>可以看到<code>CONSTRAINT</code>employee_ibfk_1<code>FOREIGN KEY (</code>depId<code>) REFERENCES</code>department<code>(</code>id<code>) ON DELETE CASCADE</code>中多了<code>ON DELETE CASCADE</code>，测试一下当我们删除部门表中的第一个数据时：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM department WHERE id=1;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br></pre></td></tr></table></figure>
<p>之前是不让删的，当我们写了一个级联的条件时可以看到成功删除，我们再看下两个数据表中的数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM department;</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">| id | depName   |</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">|  2 | 市场部    |</span><br><span class="line">|  4 | 督导部    |</span><br><span class="line">|  3 | 运营部    |</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employee;</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">| id | username | depId |</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">|  2 | queen    |     2 |</span><br><span class="line">|  3 | 张三     |     3 |</span><br><span class="line">|  4 | 李四     |     4 |</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>可以看到我们的<code>department</code>表中的部门被删掉了，同时<code>employee</code>表中的两条数据也跟着删掉了，这是删除，对于更新：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;  UPDATE department SET id=id+10;</span><br><span class="line">ERROR 1451 (23000): Cannot <span class="keyword">delete</span> <span class="keyword">or</span> <span class="keyword">update</span> a <span class="keyword">parent</span> <span class="keyword">row</span>: a foreign <span class="keyword">key</span> <span class="keyword">constraint</span> fails (<span class="string">`cms`</span>.<span class="string">`employee`</span>, <span class="keyword">CONSTRAINT</span> <span class="string">`employee_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`depId`</span>) <span class="keyword">REFERENCES</span> <span class="string">`department`</span> (<span class="string">`id`</span>) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span>)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">DELETE</span> <span class="keyword">FROM</span> employee;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; UPDATE department SET id=id+10;</span><br><span class="line">Query OK, 3 rows affected (0.01 sec)</span><br><span class="line">Rows matched: 3  Changed: 3  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM department;</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">| id | depName   |</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">| 12 | 市场部    |</span><br><span class="line">| 14 | 督导部    |</span><br><span class="line">| 13 | 运营部    |</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>可以看到我们直接更新是不允许的，除非先删除子表，再更新，我们可以用另一种方式来级联操作(先删除之前的表重新创建)：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DROP TABLE employee;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; DROP TABLE department;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS department(</span><br><span class="line">    -&gt; id TINYINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; depName VARCHAR(20) NOT NULL UNIQUE</span><br><span class="line">    -&gt; )ENGINE=INNODB;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT department(depName) VALUES('教学部'),</span><br><span class="line">    -&gt; ('市场部'),</span><br><span class="line">    -&gt; ('运营部'),</span><br><span class="line">    -&gt; ('督导部');</span><br><span class="line">Query OK, 4 rows affected (0.00 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS employee(</span><br><span class="line">    -&gt; id SMALLINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; username VARCHAR(20) NOT NULL UNIQUE,</span><br><span class="line">    -&gt; depId TINYINT UNSIGNED,</span><br><span class="line">    -&gt; FOREIGN KEY(depId) REFERENCES department(id) ON DELETE CASCADE ON UPDATE CASCADE # 这里是新加的语句</span><br><span class="line">    -&gt; )ENGINE=INNODB;</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT employee(username,depId) VALUES('king',1),</span><br><span class="line">    -&gt; ('queen',2),</span><br><span class="line">    -&gt; ('张三',3),</span><br><span class="line">    -&gt; ('李四',4),</span><br><span class="line">    -&gt; ('王五',1);</span><br><span class="line">Query OK, 5 rows affected (0.00 sec)</span><br><span class="line">Records: 5  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>继续看一下现在的表信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW CREATE TABLE employee;</span><br><span class="line">+<span class="comment">----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table    | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                                                                                                                                                                                                     |</span><br><span class="line">+<span class="comment">----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| employee | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`employee`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`depId`</span> tinyint(<span class="number">3</span>) <span class="keyword">unsigned</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`username`</span> (<span class="string">`username`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`depId`</span> (<span class="string">`depId`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`employee_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`depId`</span>) <span class="keyword">REFERENCES</span> <span class="string">`department`</span> (<span class="string">`id`</span>) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">6</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</span><br><span class="line">+<span class="comment">----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>可以看到，删除的时候是级联的，更新的时候也是级联的，我们再执行上面的删除部门，并查看：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM department WHERE id=1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM department;</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">| id | depName   |</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">|  2 | 市场部    |</span><br><span class="line">|  4 | 督导部    |</span><br><span class="line">|  3 | 运营部    |</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employee;</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">| id | username | depId |</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">|  2 | queen    |     2 |</span><br><span class="line">|  3 | 张三     |     3 |</span><br><span class="line">|  4 | 李四     |     4 |</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>可以看到成功删除，并且相应的子表数据也删除掉了，再看一下更新操作：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; UPDATE department SET id=id+10;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Rows matched: 3  Changed: 3  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM department;</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">| id | depName   |</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">| 12 | 市场部    |</span><br><span class="line">| 14 | 督导部    |</span><br><span class="line">| 13 | 运营部    |</span><br><span class="line">+<span class="comment">----+-----------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employee;</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">| id | username | depId |</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">|  2 | queen    |    12 |</span><br><span class="line">|  3 | 张三     |    13 |</span><br><span class="line">|  4 | 李四     |    14 |</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>也同样的子表随着父表更新而更新，这是<code>CASCADE</code>，再测一下<code>SET NULL</code>,先删除之前的表，并重新创建，创建的时候使用<code>SET NULL</code>:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DROP TABLE employee,department;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS department(</span><br><span class="line">    -&gt; id TINYINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; depName VARCHAR(20) NOT NULL UNIQUE</span><br><span class="line">    -&gt; )ENGINE=INNODB;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT department(depName) VALUES('教学部'),</span><br><span class="line">    -&gt; ('市场部'),</span><br><span class="line">    -&gt; ('运营部'),</span><br><span class="line">    -&gt; ('督导部');</span><br><span class="line">Query OK, 4 rows affected (0.00 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE IF NOT EXISTS employee(</span><br><span class="line">    -&gt; id SMALLINT UNSIGNED AUTO_INCREMENT KEY,</span><br><span class="line">    -&gt; username VARCHAR(20) NOT NULL UNIQUE,</span><br><span class="line">    -&gt; depId TINYINT UNSIGNED,</span><br><span class="line">    -&gt; FOREIGN KEY(depId) REFERENCES department(id) ON DELETE SET NULL ON UPDATE SET NULL</span><br><span class="line">    -&gt; )ENGINE=INNODB;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; INSERT employee(username,depId) VALUES('king',1),</span><br><span class="line">    -&gt; ('queen',2),</span><br><span class="line">    -&gt; ('张三',3),</span><br><span class="line">    -&gt; ('李四',4),</span><br><span class="line">    -&gt; ('王五',1);</span><br><span class="line">Query OK, 5 rows affected (0.00 sec)</span><br><span class="line">Records: 5  Duplicates: 0  Warnings: 0</span><br></pre></td></tr></table></figure>
<p>然后看一下表信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SHOW CREATE TABLE employee;</span><br><span class="line">+<span class="comment">----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table    | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                                                                                                                                                                                                                                                                                                       |</span><br><span class="line">+<span class="comment">----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| employee | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`employee`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">smallint</span>(<span class="number">5</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`depId`</span> tinyint(<span class="number">3</span>) <span class="keyword">unsigned</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`username`</span> (<span class="string">`username`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`depId`</span> (<span class="string">`depId`</span>),</span><br><span class="line">  <span class="keyword">CONSTRAINT</span> <span class="string">`employee_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`depId`</span>) <span class="keyword">REFERENCES</span> <span class="string">`department`</span> (<span class="string">`id`</span>) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">SET</span> <span class="literal">NULL</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">SET</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">6</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8 |</span><br><span class="line">+<span class="comment">----------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>然后我们分别执行删除和更新操作，并查看员工信息：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; DELETE FROM department WHERE id=1;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM employee;</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">| id | username | depId |</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">|  1 | king     |  NULL |</span><br><span class="line">|  2 | queen    |     2 |</span><br><span class="line">|  3 | 张三     |     3 |</span><br><span class="line">|  4 | 李四     |     4 |</span><br><span class="line">|  5 | 王五     |  NULL |</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">UPDATE</span> department <span class="keyword">SET</span> <span class="keyword">id</span>=<span class="keyword">id</span>+<span class="number">10</span>;</span><br><span class="line">Query OK, 3 rows affected (0.00 sec)</span><br><span class="line">Rows matched: 3  Changed: 3  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM employee;</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">| id | username | depId |</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">|  1 | king     |  NULL |</span><br><span class="line">|  2 | queen    |  NULL |</span><br><span class="line">|  3 | 张三     |  NULL |</span><br><span class="line">|  4 | 李四     |  NULL |</span><br><span class="line">|  5 | 王五     |  NULL |</span><br><span class="line">+<span class="comment">----+----------+-------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>可以看到我们的子表信息都会自动变为<code>NULL</code>；</p>
<h3 id="5、联合查询"><a href="#5、联合查询" class="headerlink" title="5、联合查询"></a>5、联合查询</h3><ul>
<li>UNION</li>
<li>UNION ALL</li>
</ul>
<p><code>区别是UNION去掉相同记录，UNION ALL 是简单的合并到一起</code>,例如我们查询<code>employee</code>和<code>cms_user</code>中的<code>username</code>并将结果放在一起:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT username FROM employee UNION SELECT username FROM cms_user;</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| username  |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| king      |</span><br><span class="line">| queen     |</span><br><span class="line">| 张三      |</span><br><span class="line">| 李四      |</span><br><span class="line">| 王五      |</span><br><span class="line">| blek      |</span><br><span class="line">| john      |</span><br><span class="line">| lily      |</span><br><span class="line">| long      |</span><br><span class="line">| ring      |</span><br><span class="line">| rose      |</span><br><span class="line">| sing      |</span><br><span class="line">| test1     |</span><br><span class="line">| TEST2     |</span><br><span class="line">| 张三丰    |</span><br><span class="line">| 章子怡    |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">16 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> username <span class="keyword">FROM</span> employee <span class="keyword">UNION</span> ALL <span class="keyword">SELECT</span> username <span class="keyword">FROM</span> cms_user;</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| username  |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| king      |</span><br><span class="line">| queen     |</span><br><span class="line">| 张三      |</span><br><span class="line">| 李四      |</span><br><span class="line">| 王五      |</span><br><span class="line">| blek      |</span><br><span class="line">| john      |</span><br><span class="line">| lily      |</span><br><span class="line">| long      |</span><br><span class="line">| queen     |</span><br><span class="line">| ring      |</span><br><span class="line">| rose      |</span><br><span class="line">| sing      |</span><br><span class="line">| test1     |</span><br><span class="line">| TEST2     |</span><br><span class="line">| 张三      |</span><br><span class="line">| 张三丰    |</span><br><span class="line">| 章子怡    |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">18 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p>可以看到<code>UNION</code>中去掉了重复的记录，而<code>UNION ALL</code>中并没有。需要注意的是<code>所查询的列要相同</code>。</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2017/09/19/MySql-13_subquery/">MySql_13 MySQL中的子查询</a><a class="next" href="/2017/09/13/JAVA_jdk/">你应该知道的JDK知识</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySql/">MySql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/03/19/Android_CountDownTimer/">CountDownTimer的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/05/Android_decompile/">Android 反编译</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/01/Android_dialog_shadow/">Android 使用Dialog时状态栏变黑的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/21/Python_Django_simple_server/">基于 Python 的简单服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/21/Android_about_image/">Android 图片相关操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/16/DesignPattern_01_Principle/">《设计模式》走向灵活软件之路--面向对象的六大原则</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/13/MySql-17_indexes/">MySql_17 MySQL中的索引</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/10/Android_Application_Analysis/">Application 全面解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/30/Android_Glide_Basice/">Glide基础入门</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/09/29/MySql-16_function_library/">MySql_16 MySQL中的数学函数库</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">Sing.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>