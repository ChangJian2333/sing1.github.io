<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="不知道描述啥"><title>Glide基础入门 | Sing</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Glide基础入门</h1><a id="logo" href="/.">Sing</a><p class="description">笔记</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa undefined"> 首页</i></a><a href="/django"><i class="fa undefined"> Django</i></a><a href="/html_css"><i class="fa undefined"> Html_css</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA/">JAVA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySql/">MySql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/教程/">教程</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/04/18/Linux_install_tomcat/">Linux 环境下安装 Tomcat</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/17/Linux_install_jdk/">Linux 环境下安装 JDK</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/04/11/Linux_install_mysql/">Linux 环境下安装MySql</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/29/Python_crawler/">用 Python 编写一个简单的爬虫</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/19/Android_CountDownTimer/">CountDownTimer的使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/05/Android_decompile/">Android 反编译</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/01/Android_dialog_shadow/">Android 使用Dialog时状态栏变黑的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/21/Python_Django_simple_server/">基于 Python 的简单服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/11/21/Android_about_image/">Android 图片相关操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/16/DesignPattern_01_Principle/">《设计模式》走向灵活软件之路--面向对象的六大原则</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Glide基础入门</h1><div class="post-meta">Sep 30, 2017<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span></div><div class="post-content"><h3 id="原文地址"><a href="#原文地址" class="headerlink" title="原文地址"></a><a href="https://mp.weixin.qq.com/s?__biz=MzIxNjc0ODExMA==&amp;mid=2247484473&amp;idx=1&amp;sn=b8847767dbc7896b08201c13180a4003" target="_blank" rel="noopener">原文地址</a></h3><p>转载于公众号(一个很不错的公众号)：<br><img src="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=102&amp;__biz=MzA3Njg4NTI1NQ==&amp;mid=2649860139&amp;idx=1&amp;sn=8d3a794e4171479d23f0b867075b3aa4&amp;send_time=" alt="">  </p>
<h3 id="一、前言"><a href="#一、前言" class="headerlink" title="一、前言"></a>一、前言</h3><p>Glide 现在大范围的使用在各种商业项目中，而对于一般而言， Glide 的 Api 封装的非常好，多数情况下我们只需要使用它，在使用的基础之上，才考虑如何了解它。</p>
<p>本文的目的是让你如何快速上手 Glide 3.x ，来快速投入开发，本文力求做到快速上手，所以只讲在上手的时候，你需要关注的。</p>
<h3 id="二、简单使用"><a href="#二、简单使用" class="headerlink" title="二、简单使用"></a>二、简单使用</h3><h4 id="2-1-什么是-Glide-？"><a href="#2-1-什么是-Glide-？" class="headerlink" title="2.1 什么是 Glide ？"></a>2.1 什么是 Glide ？</h4><p>既然要用到 Glide ，那就先简单的介绍一下 Glide 。  </p>
<p>Glide 简单来说就是一个 Google 主导的图片加载开源库。它稳定、速度快、可自适应图片尺寸、支持众多格式、支持加载不同来源的图片、内存和磁盘缓存的优化。这些，都是它的好处（当然不止这些），这里就不一一细说了。 </p>
<p>你只需要知道，它是一款主流的图片加载库即可，它包含了你能想到的所有功能，并且支持扩展。</p>
<p>Glide 的 <a href="https://github.com/bumptech/glide">Github 地址</a></p>
<h4 id="2-2-在项目内集成-Glide"><a href="#2-2-在项目内集成-Glide" class="headerlink" title="2.2 在项目内集成 Glide"></a>2.2 在项目内集成 Glide</h4><p>虽然它已经到 v4.x 了，但是本文还是就最常用的 v3.8.0 版本的集成，做一个简单的介绍。  </p>
<p>集成的方式有多种，可以直接引用 jar 包，也可以使用 Maven，这里还是使用主流的 Gradle 来集成它。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">  compile <span class="string">'com.github.bumptech.glide:glide:3.8.0'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果需要配置混淆，还需要在混淆文件中区分 Glide 。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-keep <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> * <span class="keyword">implements</span> <span class="title">com</span>.<span class="title">bumptech</span>.<span class="title">glide</span>.<span class="title">module</span>.<span class="title">GlideModule</span> </span></span><br><span class="line"><span class="class">-<span class="title">keep</span> <span class="title">public</span> <span class="title">enum</span> <span class="title">com</span>.<span class="title">bumptech</span>.<span class="title">glide</span>.<span class="title">load</span>.<span class="title">resource</span>.<span class="title">bitmap</span>.<span class="title">ImageHeaderParser</span>$** </span>&#123;</span><br><span class="line">  **[] $VALUES;</span><br><span class="line">  <span class="keyword">public</span> *;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>配好 Glide ，我们就可以开始使用它了。</p>
<h4 id="2-3-最简单的使用"><a href="#2-3-最简单的使用" class="headerlink" title="2.3 最简单的使用"></a>2.3 最简单的使用</h4><p>Glide 是支持链式调用的，但是它不是简单的在每个方法中返回 this ，它更复杂一些，后面会讲到，所以通常使用它只需要使用一条语句即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ImageView imageView = (ImageView) findViewById(R.id.my_image_view);</span><br><span class="line">GlideApp.with(<span class="keyword">this</span>).load(<span class="string">"http://goo.gl/gEgYUd"</span>).into(imageView);</span><br></pre></td></tr></table></figure>
<p>这是一个最简单的 Glide 的 Demo，使用它即可从网络上加载一张图片到一个 ImageView 中去显示。</p>
<h3 id="三、Glide-需要了解的内容"><a href="#三、Glide-需要了解的内容" class="headerlink" title="三、Glide 需要了解的内容"></a>三、Glide 需要了解的内容</h3><p>前面的例子可以看到，实际上 Glide 的链式调用，它的主要方法就是三个，先来简单看看他们：  </p>
<ul>
<li>with：主要是传递一个 Glide 可用的 Context，它和生命周期相关。</li>
<li>load：接收一个待加载的图片资源，可支持多种格式。</li>
<li>into：指定加载的图片的最终使用目标对象，例如可以是一个 ImageView。</li>
</ul>
<p>这三个主要的部分，贯穿了 Glide 使用的主要重点内容，接下来让我们好好看看他们。</p>
<h4 id="3-1-with"><a href="#3-1-with" class="headerlink" title="3.1 with()"></a>3.1 with()</h4><p>前面提到，这里的 with() 方法用于给 Glide 传递一个 Context 对象，它可以支持多种 Context：<br><img src="http://oupjofqw3.bkt.clouddn.com/android_glide_basice_0001.png" alt=""><br>对于 with 而言，它会返回一个 RequestManager 用于管理请求，而它接收的这些不同的 Context ，并不是为了让我们方便使用，而是会对当前 Context 的生命周期做监听，来管理 Glide 自身的图片加载的请求。  </p>
<p>举个例子：当使用 with(Activity) 的时候，如果此时当前 Activity 被关闭掉了，那么 Glide 就会将这个 Activity 下所有的图片请求停止掉。也就是实现了 Glide 和 页面生命周期的绑定，来优化 Glide 自身的请求策略。  </p>
<p>所以，在使用 Glide 的时候，尽量使用当前页面的 Activity ，而非直接传递一个 Context 进去。尽量小的选择 Context 的范围，他们的推荐优先级为：<br><code>Fragment</code>-&gt;<code>Activity</code>-&gt;<code>Context</code></p>
<h4 id="3-2-load"><a href="#3-2-load" class="headerlink" title="3.2 load()"></a>3.2 load()</h4><p>load() 方法，就是去指定一个待加载的资源，它支持很多格式和资源种类。例如：网络地址、本地文件、Drawable 等，它都是可以做到很好的加载的。  </p>
<p>load() 方法，并不是在 Glide 中，前面也提到 with() 会返回一个 RequestManager 对象，load() 方法在它内部实现：<br><img src="http://oupjofqw3.bkt.clouddn.com/android_glide_basice_0002.png" alt=""><br>具体 load() 方法，支持的资源种类，可以看到它方法的重载，基本上我们能想到的，它都支持，它返回的是另外一个 DrawableTypeRequest 对象。  </p>
<h4 id="3-3-into"><a href="#3-3-into" class="headerlink" title="3.3 into()"></a>3.3 into()</h4><p>into() 方法，用于指定加载的图片资源，最终给谁来使用。加载的图片，最终一定是用来显示的，所以它需要指定一个使用图片的对象。into() 实际上是 DrawableTypeRequest 中的方法，DrawableTypeRequest 是一个多层继承的类，它实际上自己是没有对 into() 方法的实现的，大部分实现都是在其父类 DrawableRequestBuilder 和 父类的父类 GenericRequestBuilder 中的：<br><img src="http://oupjofqw3.bkt.clouddn.com/android_glide_basice_0003.png" alt=""><br>从上可以看到 into() 不只是可以接受一个 ImageView ，也可以是一些其他的什么。这也很好理解，在项目内，也不仅仅只有 ImageView 可以用来显示图片，View 的 background 也是可以用于显示图片的。  </p>
<h3 id="四、Glide-的使用细节"><a href="#四、Glide-的使用细节" class="headerlink" title="四、Glide 的使用细节"></a>四、Glide 的使用细节</h3><p>既然 Glide 使用过程中，最重要的三个方法已经介绍过了，他们是 Glide 能完成功能的基础，接下来，就开始介绍 Glide 的使用细节，来见证 Glide 的强大。  </p>
<p>本节介绍的 Glide 的使用细节，基本上都是与 load() 方法返回的 DrawableTypeRequest 对象进行操作，对其进行一些配置。  </p>
<h4 id="4-1-不同状态的占位图"><a href="#4-1-不同状态的占位图" class="headerlink" title="4.1 不同状态的占位图"></a>4.1 不同状态的占位图</h4><p>在图片加载的过程中，会经历过多过程，例如：加载中、加载失败等等，在这些过程中，其实是可以为暂时为 ImageView 设置一个占位的的，来定制加载中、加载失败这种状态的显示效果。<br>Glide 定制的占位图，有三种：  </p>
<ul>
<li>placeholder ：指定加载前显示的图片资源。</li>
<li>error：指定加载失败显示的图片资源。</li>
<li>fallback：指定传递加载资源为 null 的时候，显示的图片资源。</li>
</ul>
<p><img src="http://oupjofqw3.bkt.clouddn.com/android_glide_basice_0004.png" alt=""><br>例如上面的例子中，其实 fallback() 是无需指定的，因为 imageUri 是不可能为 null 的。而其他的，都会在不同的阶段显示出来，加载前会显示 load_placeholder ，如果加载失败了，会显示 load_error 。不同状态的占位图，实际上是一种容错的表现，所以只能用于加载一个<code>本地资源</code>，允许传递一个 @DrawableId 或者 Drawable 对象。  </p>
<h4 id="4-2-缩放控制"><a href="#4-2-缩放控制" class="headerlink" title="4.2 缩放控制"></a>4.2 缩放控制</h4><p>某些时候，因为图片的尺寸和控件的尺寸，不一定能匹配，所以会对图片的显示效果，进行一些缩放，而大多数情况下，这种默认的缩放策略，并不是我们想要的，Glide 提供了一些方法来控制缩放的效果：</p>
<ul>
<li>centerCrop()</li>
<li>fitCenter()</li>
</ul>
<p>这两个方法和 ImageView.setScaleType() 中传递的参数效果类似，就不再一一赘述了。</p>
<h4 id="4-3-缓存控制"><a href="#4-3-缓存控制" class="headerlink" title="4.3 缓存控制"></a>4.3 缓存控制</h4><p>现在基本上所有的图片加载库，都是遵照三级缓存的策略：网络、磁盘、内存，Glide 也是如此，为了更好的体验，这些缓存默认都是全部开启的。<br>1、内存缓存，有或没有，Glide 提供了一个 skipMemoryCache() 方法传递一个 Boolean 的值用于指定是否跳过磁盘缓存，默认是 false ，表示需要内存缓存。<br>2、磁盘缓存，为了保证效率，默认会去缓存多种尺寸的图片在磁盘上的，也就是说，对于同一个 Uri，如果在不同尺寸的 ImageView 中使用到它了，默认在设备的磁盘上也会有多张不同尺寸的图片。这样下次加载的时候速度更快，是一种以空间换效率的策略。<br>3、磁盘缓存，需要使用 diskCacheStrategy() 方法来改变它，它是一种比较复杂的策略，它需要传递一个 DiskCacheStrategy 的枚举类型：  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Set of available caching strategies for media.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> DiskCacheStrategy &#123;</span><br><span class="line">    <span class="comment">/** Caches with both &#123;<span class="doctag">@link</span> #SOURCE&#125; and &#123;<span class="doctag">@link</span> #RESULT&#125;. */</span></span><br><span class="line">    ALL(<span class="keyword">true</span>, <span class="keyword">true</span>),</span><br><span class="line">    <span class="comment">/** Saves no data to cache. */</span></span><br><span class="line">    NONE(<span class="keyword">false</span>, <span class="keyword">false</span>),</span><br><span class="line">    <span class="comment">/** Saves just the original data to cache. */</span></span><br><span class="line">    SOURCE(<span class="keyword">true</span>, <span class="keyword">false</span>),</span><br><span class="line">    <span class="comment">/** Saves the media item after all transformations to cache. */</span></span><br><span class="line">    RESULT(<span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> cacheSource;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> cacheResult;</span><br><span class="line"></span><br><span class="line">    DiskCacheStrategy(<span class="keyword">boolean</span> cacheSource, <span class="keyword">boolean</span> cacheResult) &#123;</span><br><span class="line">        <span class="keyword">this</span>.cacheSource = cacheSource;</span><br><span class="line">        <span class="keyword">this</span>.cacheResult = cacheResult;</span><br><span class="line">    &#125;</span><br><span class="line">	...</span><br><span class="line">``` </span><br><span class="line">可以看到，它实际上是通过两个参数来标记磁盘缓存的策略的。</span><br><span class="line"></span><br><span class="line">* ALL：缓存所有类型的图片（默认行为）。</span><br><span class="line">* NONE ：禁用磁盘缓存。</span><br><span class="line">* SOURCE ： 只缓存全尺寸的原图。</span><br><span class="line">* RESULT ：只缓存压缩后的图片。</span><br><span class="line"></span><br><span class="line">所以具体使用那种，就需要看当前加载的图片属于哪一种了。  </span><br><span class="line"></span><br><span class="line">```JAVA</span><br><span class="line">ImageView imageView = (ImageView) findViewById(R.id.my_image_view);</span><br><span class="line">Glide.with(<span class="keyword">this</span>)</span><br><span class="line">	    .load(<span class="string">"http://goo.gl/gEgYUd"</span>)</span><br><span class="line">	    .diskCacheStrategy(DiskCacheStrategy.SOURCE)</span><br><span class="line">	    .skipMemoryCache(<span class="keyword">true</span>)</span><br><span class="line">	    .into(imageView);</span><br></pre></td></tr></table></figure>
<p>上面的例子就是忽略内存缓存，并且磁盘只缓存原图的策略。  </p>
<h4 id="4-4-加载优先级"><a href="#4-4-加载优先级" class="headerlink" title="4.4 加载优先级"></a>4.4 加载优先级</h4><p>对于同一个页面，如果需要在多个地方都加载线上图片，必然会存在一个优先级的问题。例如：正常来说，背景图是比其他图片优先级更高的图片。  </p>
<p>Glide 是可以在加载中，对当前加载的图片，调整加载的优先级的。需要使用 priority() 方法，它可以接受一个 Priority 的枚举类型，包含四种值：LOW（低）、HIGH（高）、NORMAL（普通）、IMMEDIATE（立即）。  </p>
<p>可以在我们需要的时候，对其进行配置，他只是用于 Glide 在加载图片的时候一个优化请求的参数而已，并不影响最终显示的顺序。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ImageView imageView = (ImageView) findViewById(R.id.my_image_view);</span><br><span class="line">Glide.with(<span class="keyword">this</span>)</span><br><span class="line">        .load(<span class="string">"http://goo.gl/gEgYUd"</span>)</span><br><span class="line">        .priority(Priority.IMMEDIATE)</span><br><span class="line">        .into(imageView);</span><br></pre></td></tr></table></figure>
<h4 id="4-5-载入动画"><a href="#4-5-载入动画" class="headerlink" title="4.5 载入动画"></a>4.5 载入动画</h4><p>Glide 在显示图片的时候，为了让显示效果不那么突兀，会以一种更柔和的方式去显示，就会在加载的时候给一个动画效果，它可以使用 crossFade() 方法进行配置，如果不特殊处理，默认它是开启的，默认动画的时长是 300ms。<br><img src="http://oupjofqw3.bkt.clouddn.com/android_glide_basice_0005.png" alt=""><br>crossFade() 也是有多个重载的，主要是为了指定动画以及动画的时长。而 crossFade() 的源码中实际上只是对 animate() 方法的一个包装而已。crossFade() 的效果是默认开启的，所以如果不需要这个动画效果，可以使用 dontAnimate() 来禁用动画效果。<br><img src="http://oupjofqw3.bkt.clouddn.com/android_glide_basice_0006.png" alt=""><br>有一些情况下，crossFade() 方法并不能满足我们的需求。如果对加载的动画有特殊的定制需要，可以使用更灵活的 animate() 方法来自己实现动画。<br><img src="http://oupjofqw3.bkt.clouddn.com/android_glide_basice_0007.png" alt=""><br>可以看到，animate() 支持多种格式的动画的配置，对于动画的效果，这里就不一一讲解了。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ViewPropertyAnimation.Animator animator = <span class="keyword">new</span> ViewPropertyAnimation.Animator()&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animate</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        view.setAlpha(<span class="number">0f</span>);</span><br><span class="line">        ObjectAnimator fadeAnim = ObjectAnimator.ofFloat(view,<span class="string">"alpha"</span>,<span class="number">0f</span>,<span class="number">1f</span>);</span><br><span class="line">        fadeAnim.setDuration(<span class="number">2500</span>);</span><br><span class="line">        fadeAnim.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ImageView imageView = (ImageView) findViewById(R.id.my_image_view);</span><br><span class="line">Glide.with(<span class="keyword">this</span>)</span><br><span class="line">        .load(<span class="string">"http://goo.gl/gEgYUd"</span>)</span><br><span class="line">        .animate(animator)</span><br><span class="line">        .into(imageView);</span><br></pre></td></tr></table></figure>
<h4 id="4-6-支持-Gif-amp-视频"><a href="#4-6-支持-Gif-amp-视频" class="headerlink" title="4.6 支持 Gif &amp; 视频"></a>4.6 支持 Gif &amp; 视频</h4><p>Glide 的一个非常棒的功能，就是可以支持 Gif，并且使用起来和正常的想要加载一张网络上的图片，并没有什么区别。但是有时候我们需要对加载的 Gif 图做一个检查，例如校验它是否是一个 Gif ，如果不是，则认为是一次错误的加载。这个时候就可以使用 asGif() 来进行校验，如果当前加载的图片不是一个正确的 Gif 格式，则会去显示 error() 配置的图片。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ImageView imageView = (ImageView) findViewById(R.id.my_image_view);</span><br><span class="line">Glide.with(<span class="keyword">this</span>)</span><br><span class="line">        .load(<span class="string">"http://img4q.duitang.com/uploads/item/201502/28/20150228235225_BHEXZ.gif"</span>)</span><br><span class="line">        .asGif()</span><br><span class="line">        .error(R.mipmap.load_error)</span><br><span class="line">        .into(imageView);</span><br></pre></td></tr></table></figure>
<p>当然，有时候我们可能只是为了显示一张图片，可以强制显示 Gif 图片的第一帧，使用 asBitmap() 方法标记即可（将 asGif() 替换成 asBitmap() 就可以了）。  </p>
<p>Glide 对 Gif 的支持之外，提示还对 Video 格式的文件也进行了支持。但是它和 Gif 显示的效果不一样的一点在于，它并不会去播放视频文件，而只是将视频文件的第一帧做为一个图片去显示出来。如果依然想要播放一段视频文件，使用 Glide 不是一个好注意，你应该使用 VideoView。  </p>
<p>其次 Glide 对视频的支持，仅限于本地视频，并无法对网络视频进行支持。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ImageView imageView = (ImageView) findViewById(R.id.my_image_view);</span><br><span class="line">String path = <span class="string">"/storage/emulated/0/Pictures/test.mp4"</span>;</span><br><span class="line">Glide.with(<span class="keyword">this</span>)</span><br><span class="line">        .load(Uri.fromFile(<span class="keyword">new</span> File(path)))</span><br><span class="line">        .into(imageView);</span><br></pre></td></tr></table></figure>
<h4 id="4-7-加载监听"><a href="#4-7-加载监听" class="headerlink" title="4.7 加载监听"></a>4.7 加载监听</h4><p>如果有对 Glide 加载的图片的结果进行监听的，可以使用 listener() 方法设置一个监听器，它接收一个 RequestListener 的接口  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">RequestListener listener = <span class="keyword">new</span> RequestListener&lt;String, GlideDrawable&gt;() &#123;</span><br><span class="line">            </span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onException</span><span class="params">(Exception e, String model, Target&lt;GlideDrawable&gt; target, <span class="keyword">boolean</span> isFirstResource)</span> </span>&#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onResourceReady</span><span class="params">(GlideDrawable resource, String model, Target&lt;GlideDrawable&gt; target, <span class="keyword">boolean</span> isFromMemoryCache, <span class="keyword">boolean</span> isFirstResource)</span> </span>&#123;</span><br><span class="line">	    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">    </span><br><span class="line">ImageView imageView = (ImageView) findViewById(R.id.my_image_view);</span><br><span class="line">Glide.with(<span class="keyword">this</span>)</span><br><span class="line">    .load(<span class="string">"http://goo.gl/gEgYUd"</span>)</span><br><span class="line">    .listener(listener)</span><br><span class="line">    .error(R.mipmap.load_error)</span><br><span class="line">    .into(imageView);</span><br></pre></td></tr></table></figure>
<p>一般而言，如果我们需要监听图片加载错误的原因，可以在 onException() 中做处理。  </p>
<p>需要注意的是，这两个方法的返回值，最好都是 false，因为如果返回 true ，将表示你已经处理了这次的事件，而 Glide 将不会再做额外的处理。例如，如果 onException() 返回了 true 的话，在图片加载失败之后，error() 中设置的图片，并不会被显示，因为 Glide 认为开发者已经在外部对这个错误进行了处理。  </p>
<h4 id="4-8-变换加载的图片"><a href="#4-8-变换加载的图片" class="headerlink" title="4.8 变换加载的图片"></a>4.8 变换加载的图片</h4><p>对于使用 Glide 加载的图片，如果想要在其显示之前，对其进行一些变换操作，例如，改变颜色、虚化、圆角子类的，都需要用到 transfrom() 方法，它主要用于支持在图片显示之前，自定义的变换效果。  </p>
<p>变换有两个方法：</p>
<ul>
<li>transfrom()：它可以添加一个通用的变换效果。</li>
<li>bitmapTransfrom()：限制了变换的类型，只能设置 Bitmap 的变换。</li>
</ul>
<p>变换这种操作，其实定制性非常的强，展开讲就比较复杂了，只需要知道，Glide 是可以对加载的图片在显示之前进行一些预处理的操作的，在具体使用的时候再回头来看相关资料即可。</p>
<p>这里推荐一个开源的库，来支持大多数变换的效果。</p>
<p><a href="https://github.com/wasabeef/glide-transformations">Github 地址</a></p>
<h4 id="4-9-into-其他实现"><a href="#4-9-into-其他实现" class="headerlink" title="4.9 into() 其他实现"></a>4.9 into() 其他实现</h4><p>前面所有的例子中，into() 方法作为 Glide 加载图片流程的最后一个环节，它不仅仅只能支持一个 ImageView。有时候我们还需要给 View 中设置一个背景的需要，这个使用 Glide 也是可以办到的，但是就需要用到 into() 方法的其他重载方法了。<br><img src="http://oupjofqw3.bkt.clouddn.com/android_glide_basice_0003.png" alt=""><br>撇开 into(ImageView) 不说，into(int,int) 实际上是一个指定尺寸的同步方法，可以在子线程中，通过它来得到一个 GlideDrawable 对象。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            GlideDrawable drawable = Glide.with(MainActivity.<span class="keyword">this</span>)</span><br><span class="line">                    .load(<span class="string">"http://goo.gl/gEgYUd"</span>)</span><br><span class="line">                    .error(R.mipmap.load_error)</span><br><span class="line">                    .into(<span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">                    .get();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure>
<p>但是这并不是很常用的场景，大部分我们还是使用泛型的方式来使用 Glide 的。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Set the target the resource will be loaded into.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> Glide#clear(com.bumptech.glide.request.target.Target)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> target The target to load the resource into.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> The given target.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;Y extends Target&lt;TranscodeType&gt;&gt; <span class="function">Y <span class="title">into</span><span class="params">(Y target)</span> </span>&#123;</span><br><span class="line">    Util.assertMainThread();</span><br><span class="line">    <span class="keyword">if</span> (target == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"You must pass in a non null Target"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!isModelSet) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"You must first set a model (try #load())"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Request previous = target.getRequest();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (previous != <span class="keyword">null</span>) &#123;</span><br><span class="line">        previous.clear();</span><br><span class="line">        requestTracker.removeRequest(previous);</span><br><span class="line">        previous.recycle();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Request request = buildRequest(target);</span><br><span class="line">    target.setRequest(request);</span><br><span class="line">    lifecycle.addListener(target);</span><br><span class="line">    requestTracker.runRequest(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>它的完整签名可以看出，它实际上接收的是一个 Target 对象，而 Glide 同时也提供了非常多的 Target 的子类。<br><img src="http://oupjofqw3.bkt.clouddn.com/android_glide_basice_0008.png" alt=""><br>这些子类里面，有一些是不常用的，例如 AppWidgetTarget 和 NotificationTarget 就是为了 AppWidget 和 Notification 中加载图片准备的。这里只介绍两个比较常用的 Target ：SimpleTarget 和 ViewTarget ，其实使用起来都是大同小异。  </p>
<p>如果我们不关心图片加载的用途，只是单纯的需要加载一个  Bitmap 或者 Drawable ，就可以使用 SimpleTarget 来处理。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ImageView imageView = (ImageView) findViewById(R.id.my_image_view);</span><br><span class="line"></span><br><span class="line">SimpleTarget simpleTarget = <span class="keyword">new</span> SimpleTarget&lt;GlideDrawable&gt;(<span class="number">100</span>, <span class="number">100</span>) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResourceReady</span><span class="params">(GlideDrawable resource, GlideAnimation&lt;? <span class="keyword">super</span> GlideDrawable&gt; glideAnimation)</span> </span>&#123;</span><br><span class="line">        imageView.setImageDrawable(resource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Glide.with(<span class="keyword">this</span>)</span><br><span class="line">        .load(<span class="string">"http://goo.gl/gEgYUd"</span>)</span><br><span class="line">        .into(simpleTarget);</span><br></pre></td></tr></table></figure>
<p>SimpleTarget 可以接受一个 GlideDrawable 或者 Bitmap 的类型作为加载的类型。如果需要指定加载的图片尺寸，还可以在构造方法中指定，如果不对其进行指定，则加载的是图片的原尺寸。  </p>
<p>再来看看 ViewTarget， 从名称上可以才出来，它实际上是想让 Glide 加载一个图片资源给某个 View 使用。它可以解决有时候我们显示图片的 View 并不是一个 ImageView 的问题，也可能是一个 View 的背景。  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> ImageView imageView = (ImageView) findViewById(R.id.my_image_view);</span><br><span class="line"></span><br><span class="line">ViewTarget viewTarget = <span class="keyword">new</span> ViewTarget&lt;View,GlideDrawable&gt;(imageView) &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResourceReady</span><span class="params">(GlideDrawable resource, GlideAnimation&lt;? <span class="keyword">super</span> GlideDrawable&gt; glideAnimation)</span> </span>&#123;</span><br><span class="line">        imageView.setImageDrawable(resource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Glide.with(<span class="keyword">this</span>)</span><br><span class="line">        .load(<span class="string">"http://goo.gl/gEgYUd"</span>)</span><br><span class="line">        .into(viewTarget);</span><br></pre></td></tr></table></figure>
<p>ViewTarget 需要指定 View 的类型，以及加载的资源类型，这里直接使用的 View 和 GlideDrawable ，然后将我们需要的使用图片的目标 View 当构造参数传递进去即可，最终它它会一个内部 view 变量去持有它，供之后使用,在 onResourceReady() 这个回调方法中，直接按我们的需要使用 GlideDrawable 和 View 即可。  </p>
<p>如果是需要在非 ImageView 的其他 View 上使用图片，推荐使用 ViewTarget 。它内部是会去计算 View 的尺寸，来优化缓存的图片。和加载 ImageView 的效果是一样的，如果使用 SimpleTarget 就需要考虑到 View 的尺寸问题了。  </p>
<p>在使用 Target 的时候，还有一点需要额外注意的，如果不是和页面绑定的图片资源，可以使用 ApplicationContext() ，避免当前页面被销毁之后，加载的请求也被停止了。</p>
<h3 id="五、小结"><a href="#五、小结" class="headerlink" title="五、小结"></a>五、小结</h3><p>本文最开始只是想要做一个适合初学者快速上手的 Glide 使用手册，但是越写越长，读到这里相信你也能有所收获，之后如果觉得有写概念也需要初学者了解，会继续补充。</p>
</div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2017/10/10/Android_Application_Analysis/">Application 全面解析</a><a class="next" href="/2017/09/29/MySql-16_function_library/">MySql_16 MySQL中的数学函数库</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/">京ICP备17062560号</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>